(()=>{"use strict";var __webpack_modules__={723:(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{function processElement(element,recipe,parentName="",nthChild=0){let tagName=recipe.tag_name||element.tagName.toLowerCase();tagName.endsWith("_")&&(tagName=tagName.slice(0,-1));const newElement=document.createElement(tagName);let elementText="";if(recipe.text_selector){const e=element.querySelector(recipe.text_selector);e&&(elementText=e.innerText||e.textContent||"")}else recipe.text_js?elementText=eval(recipe.text_js):recipe.add_text&&(elementText=element.innerText||element.textContent||"");elementText=elementText.replace(/\s+/g," ").trim(),recipe.text_format&&elementText&&(elementText=recipe.text_format.replace("{}",elementText)),elementText&&recipe.add_text&&(newElement.textContent=elementText);let elementName="";if(recipe.name&&("from_text"===recipe.name?(elementName=parentName?parentName+".":"",elementName+=elementText.toLowerCase().replace(/[^\w]+/g,"_")):"from_nth_child"===recipe.name?(elementName=parentName?parentName+".":"",elementName+=nthChild.toString()):(elementName=parentName?parentName+".":"",elementName+=recipe.name),newElement.setAttribute("name",elementName),parentName=elementName),recipe.clickable){if(!recipe.name)throw new Error("clickable element must have a name");let e;e=recipe.click_selector?element.querySelector(recipe.click_selector):element,e?e.setAttribute("data-clickable-id",elementName):console.log("click-element not found",element,recipe),window.clickable_recipes||(window.clickable_recipes={}),window.clickable_recipes[elementName]=recipe}if("input"===tagName){const e=element.getAttribute("type");["text","number"].includes(e)?(newElement.setAttribute("value",element.value),element.setAttribute("data-input-id",elementName)):"checkbox"===e?newElement.setAttribute("checked",element.checked.toString()):"radio"===e&&(newElement.setAttribute("checked",element.checked.toString()),element.setAttribute("data-clickable-id",elementName)),window.input_recipes||(window.input_recipes={}),window.input_recipes[elementName]=recipe}if("select"===tagName){element.setAttribute("data-select-id",elementName);const e=element.querySelectorAll("option");e.forEach((e=>{const t=e.getAttribute("value")||e.textContent.trim(),n=elementName+"."+t,r=document.createElement("option");r.textContent=e.textContent,r.setAttribute("value",t),r.setAttribute("name",n),r.setAttribute("selected",e.selected.toString()),e.setAttribute("data-clickable-id",n),newElement.appendChild(r)}))}const attrsToCopy=["alt","title","type","value","role","aria-label","aria-hidden","aria-selected"];if(attrsToCopy.forEach((e=>{const t=element.getAttribute(e);t&&newElement.setAttribute(e,t)})),recipe.keep_attr)for(const e in recipe.keep_attr){const t=element.getAttribute(e);t&&newElement.setAttribute(e,t)}if(recipe.class&&newElement.setAttribute("class",recipe.class),recipe.id&&newElement.setAttribute("id",recipe.id),recipe.override_attr)for(const key in recipe.override_attr)newElement.setAttribute(key,eval(recipe.override_attr[key]));if(recipe.children&&recipe.children.length>0)for(const e of recipe.children){const t=e.direct_child?`:scope > ${e.selector}`:e.selector,n=element.querySelectorAll(t);n.forEach(((t,n)=>{const r=processElement(t,e,parentName,n);if(newElement.appendChild(r),e.insert_split_marker&&n%(e.insert_split_marker_every||1)==0){const e=document.createElement("split-marker");newElement.appendChild(e)}if(e.insert_split_marker){const e=document.createElement("split-marker");newElement.appendChild(e)}else console.log("no split marker")}))}if(recipe.empty_message&&0===newElement.children.length){const e=document.createTextNode(recipe.empty_message);newElement.appendChild(e)}return newElement}__webpack_require__.d(__webpack_exports__,{q:()=>processElement})}},__webpack_module_cache__={};function __webpack_require__(e){var t=__webpack_module_cache__[e];if(void 0!==t)return t.exports;var n=__webpack_module_cache__[e]={exports:{}};return __webpack_modules__[e](n,n.exports,__webpack_require__),n.exports}__webpack_require__.d=(e,t)=>{for(var n in t)__webpack_require__.o(t,n)&&!__webpack_require__.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},__webpack_require__.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t);var __webpack_exports__={},_utils_element_processor__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(723),__awaiter=function(e,t,n,r){return new(n||(n=Promise))((function(o,i){function c(e){try{a(r.next(e))}catch(e){i(e)}}function l(e){try{a(r.throw(e))}catch(e){i(e)}}function a(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(c,l)}a((r=r.apply(e,t||[])).next())}))};let lastScrollTime=0;const SCROLL_THRESHOLD=1500;function generateSelector(e){if(e.id)return`#${e.id}`;let t=[],n=e;for(;n&&n!==document.body&&n.parentElement;){let e=n.tagName.toLowerCase();n.className&&"string"==typeof n.className&&(e+="."+n.className.trim().replace(/\s+/g,"."));let r=n,o=1;for(;r.previousElementSibling;)r=r.previousElementSibling,r.tagName===n.tagName&&o++;o>1&&(e+=`:nth-of-type(${o})`),t.unshift(e),n=n.parentElement}return t.join(" > ")}function setupClickInterception(){console.log("setupClickInterception");const e=EventTarget.prototype.addEventListener;EventTarget.prototype.addEventListener=function(t,n,r){if("click"===t){console.log("Intercepting click event listener");const o=function(e){try{const e=(new Date).toISOString();console.log("Captured click event"),captureInteraction("click_new",this,e,generateSelector(this),this.id||"",window.location.href)}catch(e){console.error("Error in click listener:",e)}"function"==typeof n?n.call(this,e):n&&"function"==typeof n.handleEvent&&n.handleEvent.call(n,e)};return e.call(this,t,o,r)}return e.call(this,t,n,r)}}function generateHtmlSnapshotId(){const e=window.location.href,t=(new Date).toISOString();return`html_${hashCode(e)}_${t}`}function hashCode(e){let t=0;for(let n=0;n<e.length;n++)t=(t<<5)-t+e.charCodeAt(n),t|=0;return console.log("Hash value before return:",t),t.toString()}function getClickableElementsInViewport(){const e=[];return document.querySelectorAll('a, button, [onclick], input[type="button"], input[type="submit"]').forEach((t=>{const n=t.getBoundingClientRect();n.top>=0&&n.left>=0&&n.bottom<=(window.innerHeight||document.documentElement.clientHeight)&&n.right<=(window.innerWidth||document.documentElement.clientWidth)&&e.push({tagName:t.tagName,className:t.className,id:t.id,innerText:t.innerText.trim(),outerHTML:t.outerHTML.trim()})})),e}function captureInteraction(e,t,n,r,o,i){return __awaiter(this,void 0,void 0,(function*(){try{const c=generateHtmlSnapshotId();yield new Promise(((e,t)=>{chrome.storage.local.get(["htmlSnapshots"],(n=>{const r=n.htmlSnapshots||{};r[c]=document.documentElement.outerHTML,chrome.storage.local.set({htmlSnapshots:r},(()=>{chrome.runtime.lastError?t(chrome.runtime.lastError):e(void 0)}))}))}));const l={eventType:e,timestamp:n,target:t,targetOuterHTML:t.outerHTML,targetClass:t.className,targetId:t.id,targetText:t.innerText||t.value||"",htmlSnapshotId:c,selector:r||"",clickableId:o||"",url:i||""};yield chrome.runtime.sendMessage({action:"saveData",data:l})}catch(t){console.error(`Error during ${e} event handling:`,t)}}))}function getUniqueSelector(e){if(e.id)return`#${e.id}`;if(e.className){const t=e.className.trim().split(/\s+/).join(".");return`${e.tagName.toLowerCase()}.${t}`}return e.tagName.toLowerCase()}function getFullSelector(e){let t=[];for(;e.parentElement;)t.unshift(getUniqueSelector(e)),e=e.parentElement;return t.join(" > ")}function captureScreenshot(e){return __awaiter(this,void 0,void 0,(function*(){try{const t=`screenshot_${e}`;yield chrome.runtime.sendMessage({action:"captureScreenshot",screenshotId:t})}catch(e){console.error("Error capturing screenshot:",e)}}))}setupClickInterception(),document.addEventListener("DOMContentLoaded",(()=>__awaiter(void 0,void 0,void 0,(function*(){console.log("DOMContentLoaded");const e=window.location.href;try{const t=yield new Promise((t=>{chrome.runtime.sendMessage({action:"getRecipe",url:e},t)}));if(console.log("response"),t&&t.recipe){const e=t.recipe,n=document.querySelector(e.selector);if(n){const t=(0,_utils_element_processor__WEBPACK_IMPORTED_MODULE_0__.q)(n,e);console.log(t.outerHTML)}}}catch(e){console.error("Error initializing clickable elements:",e)}})))),document.addEventListener("scroll",(e=>__awaiter(void 0,void 0,void 0,(function*(){try{const t=Date.now();if(t-lastScrollTime>=SCROLL_THRESHOLD){lastScrollTime=t;const n=(new Date).toISOString();yield captureInteraction("scroll",e.target,n,"","",""),yield captureScreenshot(n)}}catch(e){console.error("Error during scroll event handling:",e)}})))),document.addEventListener("blur",(e=>__awaiter(void 0,void 0,void 0,(function*(){const t=e.target;if(t&&("INPUT"===t.tagName&&"text"===t.type||"TEXTAREA"===t.tagName)){const e=(new Date).toISOString();yield captureScreenshot(e),yield captureInteraction("input",t,e,"","","")}}))),!0),document.addEventListener("DOMContentLoaded",(()=>{document.querySelectorAll('input[id="placeOrder"], input[id="turbo-checkout-pyo-button"]');const e=document.querySelector('input[id="buy-now-button"]'),t=document.querySelector('button[id="rcx-subscribe-submit-button-announce"]'),n=document.querySelector('input[name="proceedToRetailCheckout"]');[e,t].forEach((e=>{e&&e.addEventListener("click",(()=>__awaiter(void 0,void 0,void 0,(function*(){var t,n,r,o,i;try{const c={title:(null===(n=null===(t=document.querySelector("#title"))||void 0===t?void 0:t.innerText)||void 0===n?void 0:n.trim())||"",price:(null===(o=null===(r=document.querySelector("span.a-price.aok-align-center.reinventPricePriceToPayMargin.priceToPay"))||void 0===r?void 0:r.innerText)||void 0===o?void 0:o.trim())||"",asin:(null===(i=document.querySelector("input#ASIN"))||void 0===i?void 0:i.value)||"",options:{}};Array.from(document.querySelectorAll("#twister div.a-row:has(label.a-form-label):has(span.selection)")).forEach((e=>{var t,n,r;const o=(null===(n=null===(t=e.querySelector("label.a-form-label"))||void 0===t?void 0:t.innerText)||void 0===n?void 0:n.replace(": ",""))||"",i=(null===(r=e.querySelector("span.selection"))||void 0===r?void 0:r.innerText)||"";o&&i&&(c.options[o]=i)})),console.log(`${e.id} clicked - Product Info:`,c);const l=(yield chrome.storage.local.get({orderDetails:[]})).orderDetails||[];l.push({name:c.title,price:parseFloat(c.price.replace(/[^0-9.]/g,"")),asin:c.asin,options:c.options}),yield chrome.storage.local.set({orderDetails:l})}catch(t){console.error(`Error capturing ${e.id} product info:`,t)}}))))})),n&&n.addEventListener("click",(e=>__awaiter(void 0,void 0,void 0,(function*(){var e,t,n;try{const r=[],o=Array.from(document.querySelectorAll('[id^="sc-active-"]')).filter((e=>"sc-active-cart"!==e.id));for(const i of o){const o=i.querySelector('input[type="checkbox"]');if(o&&o.checked){const o=i.querySelector(".sc-item-product-title-cont .sc-product-link");if(o){const c=o.querySelector(".a-truncate-full"),l=(null===(e=null==c?void 0:c.textContent)||void 0===e?void 0:e.trim())||"",a=(null===(t=(o.getAttribute("href")||"").match(/product\/([A-Z0-9]{10})/))||void 0===t?void 0:t[1])||"",s=i.querySelector(".sc-item-price-block .a-offscreen"),m=s?parseFloat((null===(n=s.textContent)||void 0===n?void 0:n.replace(/[^0-9.]/g,""))||"0"):0,d={};i.querySelectorAll(".sc-product-variation").forEach((e=>{var t,n,r,o;const i=(null===(n=null===(t=e.querySelector(".a-text-bold"))||void 0===t?void 0:t.textContent)||void 0===n?void 0:n.trim().replace(":",""))||"",c=(null===(o=null===(r=e.querySelector(".a-size-small:not(.a-text-bold)"))||void 0===r?void 0:r.textContent)||void 0===o?void 0:o.trim())||"";i&&c&&(d[i]=c)})),r.push({name:l,asin:a,price:m,options:d})}}}if(r.length>0){const e=((yield chrome.storage.local.get({orderDetails:[]})).orderDetails||[]).concat(r);yield chrome.storage.local.set({orderDetails:e}),console.log("Stored selected cart items:",r)}}catch(e){console.error("Error capturing selected cart items:",e)}}))))})),chrome.runtime.onMessage.addListener(((e,t,n)=>("getHTML"===e.action&&n({html:document.documentElement.outerHTML}),!0)))})();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,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dGFydGVyLy4vc3JjL3V0aWxzL2VsZW1lbnQtcHJvY2Vzc29yLnRzIiwid2VicGFjazovL2Nocm9tZS1leHRlbnNpb24tdHlwZXNjcmlwdC1zdGFydGVyL3dlYnBhY2svYm9vdHN0cmFwIiwid2VicGFjazovL2Nocm9tZS1leHRlbnNpb24tdHlwZXNjcmlwdC1zdGFydGVyL3dlYnBhY2svcnVudGltZS9kZWZpbmUgcHJvcGVydHkgZ2V0dGVycyIsIndlYnBhY2s6Ly9jaHJvbWUtZXh0ZW5zaW9uLXR5cGVzY3JpcHQtc3RhcnRlci93ZWJwYWNrL3J1bnRpbWUvaGFzT3duUHJvcGVydHkgc2hvcnRoYW5kIiwid2VicGFjazovL2Nocm9tZS1leHRlbnNpb24tdHlwZXNjcmlwdC1zdGFydGVyLy4vc3JjL2NvbnRlbnRfc2NyaXB0LnRzIl0sInNvdXJjZXNDb250ZW50IjpbImV4cG9ydCBmdW5jdGlvbiBwcm9jZXNzRWxlbWVudChlbGVtZW50LCByZWNpcGUsIHBhcmVudE5hbWUgPSBcIlwiLCBudGhDaGlsZCA9IDApIHtcbiAgICAvLyBDcmVhdGUgYSBuZXcgZWxlbWVudCB1c2luZyB0aGUgRE9NIEFQSVxuICAgIGxldCB0YWdOYW1lID0gcmVjaXBlLnRhZ19uYW1lIHx8IGVsZW1lbnQudGFnTmFtZS50b0xvd2VyQ2FzZSgpO1xuICAgIC8vIEhhbmRsZSB1bmRlcnNjb3JlZCB0YWdzXG4gICAgaWYgKHRhZ05hbWUuZW5kc1dpdGgoXCJfXCIpKSB7XG4gICAgICAgIHRhZ05hbWUgPSB0YWdOYW1lLnNsaWNlKDAsIC0xKTtcbiAgICB9XG4gICAgY29uc3QgbmV3RWxlbWVudCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQodGFnTmFtZSk7XG4gICAgLy8gRXh0cmFjdCB0ZXh0IGNvbnRlbnQgYmFzZWQgb24gdGhlIHJlY2lwZVxuICAgIGxldCBlbGVtZW50VGV4dCA9IFwiXCI7XG4gICAgaWYgKHJlY2lwZS50ZXh0X3NlbGVjdG9yKSB7XG4gICAgICAgIGNvbnN0IHRleHRFbGVtZW50ID0gZWxlbWVudC5xdWVyeVNlbGVjdG9yKHJlY2lwZS50ZXh0X3NlbGVjdG9yKTtcbiAgICAgICAgaWYgKHRleHRFbGVtZW50KSB7XG4gICAgICAgICAgICBlbGVtZW50VGV4dCA9IHRleHRFbGVtZW50LmlubmVyVGV4dCB8fCB0ZXh0RWxlbWVudC50ZXh0Q29udGVudCB8fCBcIlwiO1xuICAgICAgICB9XG4gICAgfVxuICAgIGVsc2UgaWYgKHJlY2lwZS50ZXh0X2pzKSB7XG4gICAgICAgIGVsZW1lbnRUZXh0ID0gZXZhbChyZWNpcGUudGV4dF9qcyk7XG4gICAgfVxuICAgIGVsc2UgaWYgKHJlY2lwZS5hZGRfdGV4dCkge1xuICAgICAgICBlbGVtZW50VGV4dCA9IGVsZW1lbnQuaW5uZXJUZXh0IHx8IGVsZW1lbnQudGV4dENvbnRlbnQgfHwgXCJcIjtcbiAgICB9XG4gICAgZWxlbWVudFRleHQgPSBlbGVtZW50VGV4dC5yZXBsYWNlKC9cXHMrL2csIFwiIFwiKS50cmltKCk7XG4gICAgaWYgKHJlY2lwZS50ZXh0X2Zvcm1hdCAmJiBlbGVtZW50VGV4dCkge1xuICAgICAgICBlbGVtZW50VGV4dCA9IHJlY2lwZS50ZXh0X2Zvcm1hdC5yZXBsYWNlKFwie31cIiwgZWxlbWVudFRleHQpO1xuICAgIH1cbiAgICBpZiAoZWxlbWVudFRleHQgJiYgcmVjaXBlLmFkZF90ZXh0KSB7XG4gICAgICAgIG5ld0VsZW1lbnQudGV4dENvbnRlbnQgPSBlbGVtZW50VGV4dDtcbiAgICB9XG4gICAgLy8gQnVpbGQgdGhlIG5vZGUgYXR0cmlidXRlc1xuICAgIGxldCBlbGVtZW50TmFtZSA9IFwiXCI7XG4gICAgaWYgKHJlY2lwZS5uYW1lKSB7XG4gICAgICAgIGlmIChyZWNpcGUubmFtZSA9PT0gXCJmcm9tX3RleHRcIikge1xuICAgICAgICAgICAgZWxlbWVudE5hbWUgPSBwYXJlbnROYW1lID8gcGFyZW50TmFtZSArIFwiLlwiIDogXCJcIjtcbiAgICAgICAgICAgIGVsZW1lbnROYW1lICs9IGVsZW1lbnRUZXh0LnRvTG93ZXJDYXNlKCkucmVwbGFjZSgvW15cXHddKy9nLCBcIl9cIik7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSBpZiAocmVjaXBlLm5hbWUgPT09IFwiZnJvbV9udGhfY2hpbGRcIikge1xuICAgICAgICAgICAgZWxlbWVudE5hbWUgPSBwYXJlbnROYW1lID8gcGFyZW50TmFtZSArIFwiLlwiIDogXCJcIjtcbiAgICAgICAgICAgIGVsZW1lbnROYW1lICs9IG50aENoaWxkLnRvU3RyaW5nKCk7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICBlbGVtZW50TmFtZSA9IHBhcmVudE5hbWUgPyBwYXJlbnROYW1lICsgXCIuXCIgOiBcIlwiO1xuICAgICAgICAgICAgZWxlbWVudE5hbWUgKz0gcmVjaXBlLm5hbWU7XG4gICAgICAgIH1cbiAgICAgICAgbmV3RWxlbWVudC5zZXRBdHRyaWJ1dGUoXCJuYW1lXCIsIGVsZW1lbnROYW1lKTtcbiAgICAgICAgcGFyZW50TmFtZSA9IGVsZW1lbnROYW1lO1xuICAgIH1cbiAgICAvLyBIYW5kbGUgY2xpY2thYmxlcyBhbmQgaW5wdXRzXG4gICAgaWYgKHJlY2lwZS5jbGlja2FibGUpIHtcbiAgICAgICAgaWYgKCFyZWNpcGUubmFtZSkge1xuICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwiY2xpY2thYmxlIGVsZW1lbnQgbXVzdCBoYXZlIGEgbmFtZVwiKTtcbiAgICAgICAgfVxuICAgICAgICAvLyBoYW5kbGUgY2xpY2tfc2VsZWN0b3JcbiAgICAgICAgbGV0IGNsaWNrX2VsZW1lbnQ7XG4gICAgICAgIGlmIChyZWNpcGUuY2xpY2tfc2VsZWN0b3IpIHtcbiAgICAgICAgICAgIGNsaWNrX2VsZW1lbnQgPSBlbGVtZW50LnF1ZXJ5U2VsZWN0b3IocmVjaXBlLmNsaWNrX3NlbGVjdG9yKTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIGNsaWNrX2VsZW1lbnQgPSBlbGVtZW50O1xuICAgICAgICB9XG4gICAgICAgIGlmIChjbGlja19lbGVtZW50KSB7XG4gICAgICAgICAgICBjbGlja19lbGVtZW50LnNldEF0dHJpYnV0ZShcImRhdGEtY2xpY2thYmxlLWlkXCIsIGVsZW1lbnROYW1lKTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKCdjbGljay1lbGVtZW50IG5vdCBmb3VuZCcsIGVsZW1lbnQsIHJlY2lwZSk7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKCF3aW5kb3cuY2xpY2thYmxlX3JlY2lwZXMpIHtcbiAgICAgICAgICAgIHdpbmRvdy5jbGlja2FibGVfcmVjaXBlcyA9IHt9O1xuICAgICAgICB9XG4gICAgICAgIHdpbmRvdy5jbGlja2FibGVfcmVjaXBlc1tlbGVtZW50TmFtZV0gPSByZWNpcGU7XG4gICAgfVxuICAgIGlmICh0YWdOYW1lID09PSBcImlucHV0XCIpIHtcbiAgICAgICAgY29uc3QgaW5wdXRUeXBlID0gZWxlbWVudC5nZXRBdHRyaWJ1dGUoXCJ0eXBlXCIpO1xuICAgICAgICBpZiAoW1widGV4dFwiLCBcIm51bWJlclwiXS5pbmNsdWRlcyhpbnB1dFR5cGUpKSB7XG4gICAgICAgICAgICBuZXdFbGVtZW50LnNldEF0dHJpYnV0ZShcInZhbHVlXCIsIGVsZW1lbnQudmFsdWUpO1xuICAgICAgICAgICAgZWxlbWVudC5zZXRBdHRyaWJ1dGUoXCJkYXRhLWlucHV0LWlkXCIsIGVsZW1lbnROYW1lKTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIGlmIChpbnB1dFR5cGUgPT09IFwiY2hlY2tib3hcIikge1xuICAgICAgICAgICAgbmV3RWxlbWVudC5zZXRBdHRyaWJ1dGUoXCJjaGVja2VkXCIsIGVsZW1lbnQuY2hlY2tlZC50b1N0cmluZygpKTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIGlmIChpbnB1dFR5cGUgPT09IFwicmFkaW9cIikge1xuICAgICAgICAgICAgbmV3RWxlbWVudC5zZXRBdHRyaWJ1dGUoXCJjaGVja2VkXCIsIGVsZW1lbnQuY2hlY2tlZC50b1N0cmluZygpKTtcbiAgICAgICAgICAgIGVsZW1lbnQuc2V0QXR0cmlidXRlKFwiZGF0YS1jbGlja2FibGUtaWRcIiwgZWxlbWVudE5hbWUpO1xuICAgICAgICB9XG4gICAgICAgIGlmICghd2luZG93LmlucHV0X3JlY2lwZXMpIHtcbiAgICAgICAgICAgIHdpbmRvdy5pbnB1dF9yZWNpcGVzID0ge307XG4gICAgICAgIH1cbiAgICAgICAgd2luZG93LmlucHV0X3JlY2lwZXNbZWxlbWVudE5hbWVdID0gcmVjaXBlO1xuICAgIH1cbiAgICAvLyAqKkhhbmRsZSBzZWxlY3QgZWxlbWVudHMqKlxuICAgIGlmICh0YWdOYW1lID09PSBcInNlbGVjdFwiKSB7XG4gICAgICAgIC8vIFRhZyB0aGUgc2VsZWN0IGVsZW1lbnQgd2l0aCBkYXRhLXNlbGVjdC1pZFxuICAgICAgICBlbGVtZW50LnNldEF0dHJpYnV0ZShcImRhdGEtc2VsZWN0LWlkXCIsIGVsZW1lbnROYW1lKTtcbiAgICAgICAgY29uc3Qgb3B0aW9ucyA9IGVsZW1lbnQucXVlcnlTZWxlY3RvckFsbCgnb3B0aW9uJyk7XG4gICAgICAgIG9wdGlvbnMuZm9yRWFjaCgob3B0aW9uKSA9PiB7XG4gICAgICAgICAgICBjb25zdCBvcHRpb25WYWx1ZSA9IG9wdGlvbi5nZXRBdHRyaWJ1dGUoJ3ZhbHVlJykgfHwgb3B0aW9uLnRleHRDb250ZW50LnRyaW0oKTtcbiAgICAgICAgICAgIGNvbnN0IG9wdGlvbk5hbWUgPSBlbGVtZW50TmFtZSArIFwiLlwiICsgb3B0aW9uVmFsdWU7XG4gICAgICAgICAgICBjb25zdCBuZXdPcHRpb24gPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdvcHRpb24nKTtcbiAgICAgICAgICAgIG5ld09wdGlvbi50ZXh0Q29udGVudCA9IG9wdGlvbi50ZXh0Q29udGVudDtcbiAgICAgICAgICAgIG5ld09wdGlvbi5zZXRBdHRyaWJ1dGUoJ3ZhbHVlJywgb3B0aW9uVmFsdWUpO1xuICAgICAgICAgICAgbmV3T3B0aW9uLnNldEF0dHJpYnV0ZSgnbmFtZScsIG9wdGlvbk5hbWUpO1xuICAgICAgICAgICAgbmV3T3B0aW9uLnNldEF0dHJpYnV0ZSgnc2VsZWN0ZWQnLCBvcHRpb24uc2VsZWN0ZWQudG9TdHJpbmcoKSk7XG4gICAgICAgICAgICBvcHRpb24uc2V0QXR0cmlidXRlKCdkYXRhLWNsaWNrYWJsZS1pZCcsIG9wdGlvbk5hbWUpOyAvLyBUYWcgYWN0dWFsIERPTSBvcHRpb24gZWxlbWVudFxuICAgICAgICAgICAgbmV3RWxlbWVudC5hcHBlbmRDaGlsZChuZXdPcHRpb24pO1xuICAgICAgICB9KTtcbiAgICB9XG4gICAgLy8gQ29weSBzcGVjaWZpZWQgYXR0cmlidXRlc1xuICAgIGNvbnN0IGF0dHJzVG9Db3B5ID0gW1wiYWx0XCIsIFwidGl0bGVcIiwgXCJ0eXBlXCIsIFwidmFsdWVcIiwgXCJyb2xlXCIsIFwiYXJpYS1sYWJlbFwiLCBcImFyaWEtaGlkZGVuXCIsIFwiYXJpYS1zZWxlY3RlZFwiXTtcbiAgICBhdHRyc1RvQ29weS5mb3JFYWNoKChhdHRyKSA9PiB7XG4gICAgICAgIGNvbnN0IHZhbHVlID0gZWxlbWVudC5nZXRBdHRyaWJ1dGUoYXR0cik7XG4gICAgICAgIGlmICh2YWx1ZSkge1xuICAgICAgICAgICAgbmV3RWxlbWVudC5zZXRBdHRyaWJ1dGUoYXR0ciwgdmFsdWUpO1xuICAgICAgICB9XG4gICAgfSk7XG4gICAgaWYgKHJlY2lwZS5rZWVwX2F0dHIpIHtcbiAgICAgICAgZm9yIChjb25zdCBrZXkgaW4gcmVjaXBlLmtlZXBfYXR0cikge1xuICAgICAgICAgICAgY29uc3QgdmFsdWUgPSBlbGVtZW50LmdldEF0dHJpYnV0ZShrZXkpO1xuICAgICAgICAgICAgaWYgKHZhbHVlKSB7XG4gICAgICAgICAgICAgICAgbmV3RWxlbWVudC5zZXRBdHRyaWJ1dGUoa2V5LCB2YWx1ZSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9XG4gICAgaWYgKHJlY2lwZVsnY2xhc3MnXSkge1xuICAgICAgICBuZXdFbGVtZW50LnNldEF0dHJpYnV0ZSgnY2xhc3MnLCByZWNpcGVbJ2NsYXNzJ10pO1xuICAgIH1cbiAgICBpZiAocmVjaXBlWydpZCddKSB7XG4gICAgICAgIG5ld0VsZW1lbnQuc2V0QXR0cmlidXRlKCdpZCcsIHJlY2lwZVsnaWQnXSk7XG4gICAgfVxuICAgIC8vIE92ZXJyaWRlIGF0dHJpYnV0ZXMgaWYgc3BlY2lmaWVkXG4gICAgaWYgKHJlY2lwZS5vdmVycmlkZV9hdHRyKSB7XG4gICAgICAgIGZvciAoY29uc3Qga2V5IGluIHJlY2lwZS5vdmVycmlkZV9hdHRyKSB7XG4gICAgICAgICAgICBuZXdFbGVtZW50LnNldEF0dHJpYnV0ZShrZXksIGV2YWwocmVjaXBlLm92ZXJyaWRlX2F0dHJba2V5XSkpO1xuICAgICAgICB9XG4gICAgfVxuICAgIC8vIFByb2Nlc3MgY2hpbGRyZW5cbiAgICBpZiAocmVjaXBlLmNoaWxkcmVuICYmIHJlY2lwZS5jaGlsZHJlbi5sZW5ndGggPiAwKSB7XG4gICAgICAgIGZvciAoY29uc3QgY2hpbGRSZWNpcGUgb2YgcmVjaXBlLmNoaWxkcmVuKSB7XG4gICAgICAgICAgICBjb25zdCBzZWxlY3RvciA9IGNoaWxkUmVjaXBlLmRpcmVjdF9jaGlsZCA/IGA6c2NvcGUgPiAke2NoaWxkUmVjaXBlLnNlbGVjdG9yfWAgOiBjaGlsZFJlY2lwZS5zZWxlY3RvcjtcbiAgICAgICAgICAgIGNvbnN0IGNoaWxkRWxlbWVudHMgPSBlbGVtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoc2VsZWN0b3IpO1xuICAgICAgICAgICAgY2hpbGRFbGVtZW50cy5mb3JFYWNoKChjaGlsZEVsZW1lbnQsIGluZGV4KSA9PiB7XG4gICAgICAgICAgICAgICAgY29uc3QgY2hpbGROb2RlID0gcHJvY2Vzc0VsZW1lbnQoY2hpbGRFbGVtZW50LCBjaGlsZFJlY2lwZSwgcGFyZW50TmFtZSwgaW5kZXgpO1xuICAgICAgICAgICAgICAgIG5ld0VsZW1lbnQuYXBwZW5kQ2hpbGQoY2hpbGROb2RlKTtcbiAgICAgICAgICAgICAgICBpZiAoY2hpbGRSZWNpcGUuaW5zZXJ0X3NwbGl0X21hcmtlcikge1xuICAgICAgICAgICAgICAgICAgICBjb25zdCBldmVyeSA9IGNoaWxkUmVjaXBlLmluc2VydF9zcGxpdF9tYXJrZXJfZXZlcnkgfHwgMTtcbiAgICAgICAgICAgICAgICAgICAgaWYgKGluZGV4ICUgZXZlcnkgPT0gMCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgY29uc3Qgc3BsaXRNYXJrZXIgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdzcGxpdC1tYXJrZXInKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIG5ld0VsZW1lbnQuYXBwZW5kQ2hpbGQoc3BsaXRNYXJrZXIpO1xuICAgICAgICAgICAgICAgICAgICAgICAgLy8gY29uc29sZS5sb2coXCJpbnNlcnRpbmcgc3BsaXQgbWFya2VyIDFcIik7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgaWYgKGNoaWxkUmVjaXBlLmluc2VydF9zcGxpdF9tYXJrZXIpIHtcbiAgICAgICAgICAgICAgICAgICAgLy8gY29uc29sZS5sb2coXCJpbnNlcnRpbmcgc3BsaXQgbWFya2VyIDJcIik7XG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IHNwbGl0TWFya2VyID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnc3BsaXQtbWFya2VyJyk7XG4gICAgICAgICAgICAgICAgICAgIG5ld0VsZW1lbnQuYXBwZW5kQ2hpbGQoc3BsaXRNYXJrZXIpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coXCJubyBzcGxpdCBtYXJrZXJcIik7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICB9XG4gICAgLy8gSGFuZGxlIGVtcHR5IG1lc3NhZ2VzXG4gICAgaWYgKHJlY2lwZS5lbXB0eV9tZXNzYWdlICYmIG5ld0VsZW1lbnQuY2hpbGRyZW4ubGVuZ3RoID09PSAwKSB7XG4gICAgICAgIGNvbnN0IGVtcHR5VGV4dE5vZGUgPSBkb2N1bWVudC5jcmVhdGVUZXh0Tm9kZShyZWNpcGUuZW1wdHlfbWVzc2FnZSk7XG4gICAgICAgIG5ld0VsZW1lbnQuYXBwZW5kQ2hpbGQoZW1wdHlUZXh0Tm9kZSk7XG4gICAgfVxuICAgIHJldHVybiBuZXdFbGVtZW50O1xufVxuIiwiLy8gVGhlIG1vZHVsZSBjYWNoZVxudmFyIF9fd2VicGFja19tb2R1bGVfY2FjaGVfXyA9IHt9O1xuXG4vLyBUaGUgcmVxdWlyZSBmdW5jdGlvblxuZnVuY3Rpb24gX193ZWJwYWNrX3JlcXVpcmVfXyhtb2R1bGVJZCkge1xuXHQvLyBDaGVjayBpZiBtb2R1bGUgaXMgaW4gY2FjaGVcblx0dmFyIGNhY2hlZE1vZHVsZSA9IF9fd2VicGFja19tb2R1bGVfY2FjaGVfX1ttb2R1bGVJZF07XG5cdGlmIChjYWNoZWRNb2R1bGUgIT09IHVuZGVmaW5lZCkge1xuXHRcdHJldHVybiBjYWNoZWRNb2R1bGUuZXhwb3J0cztcblx0fVxuXHQvLyBDcmVhdGUgYSBuZXcgbW9kdWxlIChhbmQgcHV0IGl0IGludG8gdGhlIGNhY2hlKVxuXHR2YXIgbW9kdWxlID0gX193ZWJwYWNrX21vZHVsZV9jYWNoZV9fW21vZHVsZUlkXSA9IHtcblx0XHQvLyBubyBtb2R1bGUuaWQgbmVlZGVkXG5cdFx0Ly8gbm8gbW9kdWxlLmxvYWRlZCBuZWVkZWRcblx0XHRleHBvcnRzOiB7fVxuXHR9O1xuXG5cdC8vIEV4ZWN1dGUgdGhlIG1vZHVsZSBmdW5jdGlvblxuXHRfX3dlYnBhY2tfbW9kdWxlc19fW21vZHVsZUlkXShtb2R1bGUsIG1vZHVsZS5leHBvcnRzLCBfX3dlYnBhY2tfcmVxdWlyZV9fKTtcblxuXHQvLyBSZXR1cm4gdGhlIGV4cG9ydHMgb2YgdGhlIG1vZHVsZVxuXHRyZXR1cm4gbW9kdWxlLmV4cG9ydHM7XG59XG5cbiIsIi8vIGRlZmluZSBnZXR0ZXIgZnVuY3Rpb25zIGZvciBoYXJtb255IGV4cG9ydHNcbl9fd2VicGFja19yZXF1aXJlX18uZCA9IChleHBvcnRzLCBkZWZpbml0aW9uKSA9PiB7XG5cdGZvcih2YXIga2V5IGluIGRlZmluaXRpb24pIHtcblx0XHRpZihfX3dlYnBhY2tfcmVxdWlyZV9fLm8oZGVmaW5pdGlvbiwga2V5KSAmJiAhX193ZWJwYWNrX3JlcXVpcmVfXy5vKGV4cG9ydHMsIGtleSkpIHtcblx0XHRcdE9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBrZXksIHsgZW51bWVyYWJsZTogdHJ1ZSwgZ2V0OiBkZWZpbml0aW9uW2tleV0gfSk7XG5cdFx0fVxuXHR9XG59OyIsIl9fd2VicGFja19yZXF1aXJlX18ubyA9IChvYmosIHByb3ApID0+IChPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwob2JqLCBwcm9wKSkiLCJ2YXIgX19hd2FpdGVyID0gKHRoaXMgJiYgdGhpcy5fX2F3YWl0ZXIpIHx8IGZ1bmN0aW9uICh0aGlzQXJnLCBfYXJndW1lbnRzLCBQLCBnZW5lcmF0b3IpIHtcbiAgICBmdW5jdGlvbiBhZG9wdCh2YWx1ZSkgeyByZXR1cm4gdmFsdWUgaW5zdGFuY2VvZiBQID8gdmFsdWUgOiBuZXcgUChmdW5jdGlvbiAocmVzb2x2ZSkgeyByZXNvbHZlKHZhbHVlKTsgfSk7IH1cbiAgICByZXR1cm4gbmV3IChQIHx8IChQID0gUHJvbWlzZSkpKGZ1bmN0aW9uIChyZXNvbHZlLCByZWplY3QpIHtcbiAgICAgICAgZnVuY3Rpb24gZnVsZmlsbGVkKHZhbHVlKSB7IHRyeSB7IHN0ZXAoZ2VuZXJhdG9yLm5leHQodmFsdWUpKTsgfSBjYXRjaCAoZSkgeyByZWplY3QoZSk7IH0gfVxuICAgICAgICBmdW5jdGlvbiByZWplY3RlZCh2YWx1ZSkgeyB0cnkgeyBzdGVwKGdlbmVyYXRvcltcInRocm93XCJdKHZhbHVlKSk7IH0gY2F0Y2ggKGUpIHsgcmVqZWN0KGUpOyB9IH1cbiAgICAgICAgZnVuY3Rpb24gc3RlcChyZXN1bHQpIHsgcmVzdWx0LmRvbmUgPyByZXNvbHZlKHJlc3VsdC52YWx1ZSkgOiBhZG9wdChyZXN1bHQudmFsdWUpLnRoZW4oZnVsZmlsbGVkLCByZWplY3RlZCk7IH1cbiAgICAgICAgc3RlcCgoZ2VuZXJhdG9yID0gZ2VuZXJhdG9yLmFwcGx5KHRoaXNBcmcsIF9hcmd1bWVudHMgfHwgW10pKS5uZXh0KCkpO1xuICAgIH0pO1xufTtcbmltcG9ydCB7IHByb2Nlc3NFbGVtZW50IH0gZnJvbSAnLi91dGlscy9lbGVtZW50LXByb2Nlc3Nvcic7XG5sZXQgbGFzdFNjcm9sbFRpbWUgPSAwOyAvLyBUcmFjayBsYXN0IHNjcm9sbCB0aW1lc3RhbXBcbmNvbnN0IFNDUk9MTF9USFJFU0hPTEQgPSAxNTAwOyAvLyBNaW5pbXVtIHRpbWUgaW4gbXMgYmV0d2VlbiBzY3JlZW5zaG90cyBmb3Igc2Nyb2xsIGFjdGlvbnNcbmZ1bmN0aW9uIGdlbmVyYXRlU2VsZWN0b3IoZWxlbWVudCkge1xuICAgIGlmIChlbGVtZW50LmlkKSB7XG4gICAgICAgIHJldHVybiBgIyR7ZWxlbWVudC5pZH1gO1xuICAgIH1cbiAgICBsZXQgcGF0aCA9IFtdO1xuICAgIGxldCBjdXJyZW50ID0gZWxlbWVudDtcbiAgICB3aGlsZSAoY3VycmVudCAmJiBjdXJyZW50ICE9PSBkb2N1bWVudC5ib2R5ICYmIGN1cnJlbnQucGFyZW50RWxlbWVudCkge1xuICAgICAgICBsZXQgc2VsZWN0b3IgPSBjdXJyZW50LnRhZ05hbWUudG9Mb3dlckNhc2UoKTtcbiAgICAgICAgLy8g5re75Yqg57G75ZCN77yI5Y+v6YCJ77yJXG4gICAgICAgIGlmIChjdXJyZW50LmNsYXNzTmFtZSAmJiB0eXBlb2YgY3VycmVudC5jbGFzc05hbWUgPT09ICdzdHJpbmcnKSB7XG4gICAgICAgICAgICBzZWxlY3RvciArPSAnLicgKyBjdXJyZW50LmNsYXNzTmFtZS50cmltKCkucmVwbGFjZSgvXFxzKy9nLCAnLicpO1xuICAgICAgICB9XG4gICAgICAgIC8vIOa3u+WKoOWQjOe6p+WFg+e0oOS4reeahOS9jee9rlxuICAgICAgICBsZXQgc2libGluZyA9IGN1cnJlbnQ7XG4gICAgICAgIGxldCBudGggPSAxO1xuICAgICAgICB3aGlsZSAoc2libGluZy5wcmV2aW91c0VsZW1lbnRTaWJsaW5nKSB7XG4gICAgICAgICAgICBzaWJsaW5nID0gc2libGluZy5wcmV2aW91c0VsZW1lbnRTaWJsaW5nO1xuICAgICAgICAgICAgaWYgKHNpYmxpbmcudGFnTmFtZSA9PT0gY3VycmVudC50YWdOYW1lKSB7XG4gICAgICAgICAgICAgICAgbnRoKys7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgaWYgKG50aCA+IDEpIHtcbiAgICAgICAgICAgIHNlbGVjdG9yICs9IGA6bnRoLW9mLXR5cGUoJHtudGh9KWA7XG4gICAgICAgIH1cbiAgICAgICAgcGF0aC51bnNoaWZ0KHNlbGVjdG9yKTtcbiAgICAgICAgY3VycmVudCA9IGN1cnJlbnQucGFyZW50RWxlbWVudDtcbiAgICB9XG4gICAgcmV0dXJuIHBhdGguam9pbignID4gJyk7XG59XG4vLyBtb25rZXkgcGF0Y2hcbmZ1bmN0aW9uIHNldHVwQ2xpY2tJbnRlcmNlcHRpb24oKSB7XG4gICAgY29uc29sZS5sb2coJ3NldHVwQ2xpY2tJbnRlcmNlcHRpb24nKTtcbiAgICBjb25zdCBvcmlnaW5hbEFkZEV2ZW50TGlzdGVuZXIgPSBFdmVudFRhcmdldC5wcm90b3R5cGUuYWRkRXZlbnRMaXN0ZW5lcjtcbiAgICBFdmVudFRhcmdldC5wcm90b3R5cGUuYWRkRXZlbnRMaXN0ZW5lciA9IGZ1bmN0aW9uICh0eXBlLCBsaXN0ZW5lciwgb3B0aW9ucykge1xuICAgICAgICBpZiAodHlwZSA9PT0gJ2NsaWNrJykge1xuICAgICAgICAgICAgY29uc29sZS5sb2coJ0ludGVyY2VwdGluZyBjbGljayBldmVudCBsaXN0ZW5lcicpO1xuICAgICAgICAgICAgY29uc3Qgd3JhcHBlZExpc3RlbmVyID0gZnVuY3Rpb24gKGV2ZW50KSB7XG4gICAgICAgICAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgdGltZXN0YW1wID0gbmV3IERhdGUoKS50b0lTT1N0cmluZygpO1xuICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZygnQ2FwdHVyZWQgY2xpY2sgZXZlbnQnKTtcbiAgICAgICAgICAgICAgICAgICAgY2FwdHVyZUludGVyYWN0aW9uKCdjbGlja19uZXcnLCB0aGlzLCB0aW1lc3RhbXAsIGdlbmVyYXRlU2VsZWN0b3IodGhpcyksIHRoaXMuaWQgfHwgJycsIHdpbmRvdy5sb2NhdGlvbi5ocmVmKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgICAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoJ0Vycm9yIGluIGNsaWNrIGxpc3RlbmVyOicsIGVycm9yKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgaWYgKHR5cGVvZiBsaXN0ZW5lciA9PT0gJ2Z1bmN0aW9uJykge1xuICAgICAgICAgICAgICAgICAgICBsaXN0ZW5lci5jYWxsKHRoaXMsIGV2ZW50KTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgZWxzZSBpZiAobGlzdGVuZXIgJiYgdHlwZW9mIGxpc3RlbmVyLmhhbmRsZUV2ZW50ID09PSAnZnVuY3Rpb24nKSB7XG4gICAgICAgICAgICAgICAgICAgIGxpc3RlbmVyLmhhbmRsZUV2ZW50LmNhbGwobGlzdGVuZXIsIGV2ZW50KTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9O1xuICAgICAgICAgICAgLy8g5L2/55So5Y6f5aeL55qEYWRkRXZlbnRMaXN0ZW5lcuadpea3u+WKoOWMheijheWQjueahOebkeWQrOWZqFxuICAgICAgICAgICAgcmV0dXJuIG9yaWdpbmFsQWRkRXZlbnRMaXN0ZW5lci5jYWxsKHRoaXMsIHR5cGUsIHdyYXBwZWRMaXN0ZW5lciwgb3B0aW9ucyk7XG4gICAgICAgIH1cbiAgICAgICAgLy8gb3RoZXIgZXZlbnRzIHVzZSBvcmlnaW5hbCBhZGRFdmVudExpc3RlbmVyXG4gICAgICAgIHJldHVybiBvcmlnaW5hbEFkZEV2ZW50TGlzdGVuZXIuY2FsbCh0aGlzLCB0eXBlLCBsaXN0ZW5lciwgb3B0aW9ucyk7XG4gICAgfTtcbn1cbnNldHVwQ2xpY2tJbnRlcmNlcHRpb24oKTtcbmRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoJ0RPTUNvbnRlbnRMb2FkZWQnLCAoKSA9PiBfX2F3YWl0ZXIodm9pZCAwLCB2b2lkIDAsIHZvaWQgMCwgZnVuY3Rpb24qICgpIHtcbiAgICBjb25zb2xlLmxvZygnRE9NQ29udGVudExvYWRlZCcpO1xuICAgIGNvbnN0IHVybCA9IHdpbmRvdy5sb2NhdGlvbi5ocmVmO1xuICAgIHRyeSB7XG4gICAgICAgIGNvbnN0IHJlc3BvbnNlID0geWllbGQgbmV3IFByb21pc2UocmVzb2x2ZSA9PiB7XG4gICAgICAgICAgICBjaHJvbWUucnVudGltZS5zZW5kTWVzc2FnZSh7XG4gICAgICAgICAgICAgICAgYWN0aW9uOiAnZ2V0UmVjaXBlJyxcbiAgICAgICAgICAgICAgICB1cmw6IHVybFxuICAgICAgICAgICAgfSwgcmVzb2x2ZSk7XG4gICAgICAgIH0pO1xuICAgICAgICBjb25zb2xlLmxvZygncmVzcG9uc2UnKTtcbiAgICAgICAgaWYgKHJlc3BvbnNlICYmIHJlc3BvbnNlLnJlY2lwZSkge1xuICAgICAgICAgICAgY29uc3QgcmVjaXBlID0gcmVzcG9uc2UucmVjaXBlO1xuICAgICAgICAgICAgY29uc3Qgcm9vdEVsZW1lbnQgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKHJlY2lwZS5zZWxlY3Rvcik7XG4gICAgICAgICAgICBpZiAocm9vdEVsZW1lbnQpIHtcbiAgICAgICAgICAgICAgICBjb25zdCBuZXdSb290ID0gcHJvY2Vzc0VsZW1lbnQocm9vdEVsZW1lbnQsIHJlY2lwZSk7XG4gICAgICAgICAgICAgICAgY29uc29sZS5sb2cobmV3Um9vdC5vdXRlckhUTUwpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfVxuICAgIGNhdGNoIChlcnJvcikge1xuICAgICAgICBjb25zb2xlLmVycm9yKCdFcnJvciBpbml0aWFsaXppbmcgY2xpY2thYmxlIGVsZW1lbnRzOicsIGVycm9yKTtcbiAgICB9XG4gICAgLy8gdHJ5e1xuICAgIC8vICAgICBjb25zdCB0aW1lc3RhbXAgPSBuZXcgRGF0ZSgpLnRvSVNPU3RyaW5nKCk7XG4gICAgLy8gICAgIGNhcHR1cmVTY3JlZW5zaG90KHRpbWVzdGFtcCk7XG4gICAgLy8gICAgIGNhcHR1cmVJbnRlcmFjdGlvbignbmF2aWdhdGUnLCAnJyx0aW1lc3RhbXAsJycsJycsdXJsKTtcbiAgICAvLyB9Y2F0Y2goZXJyb3Ipe1xuICAgIC8vICAgICBjb25zb2xlLmVycm9yKCdFcnJvciBjYXB0dXJpbmcgc2NyZWVuc2hvdDonLCBlcnJvcik7XG4gICAgLy8gfVxufSkpO1xuZnVuY3Rpb24gZ2VuZXJhdGVIdG1sU25hcHNob3RJZCgpIHtcbiAgICBjb25zdCB1cmwgPSB3aW5kb3cubG9jYXRpb24uaHJlZjtcbiAgICBjb25zdCB0aW1lc3RhbXAgPSBuZXcgRGF0ZSgpLnRvSVNPU3RyaW5nKCk7XG4gICAgcmV0dXJuIGBodG1sXyR7aGFzaENvZGUodXJsKX1fJHt0aW1lc3RhbXB9YDtcbn1cbmZ1bmN0aW9uIGhhc2hDb2RlKHN0cikge1xuICAgIGxldCBoYXNoID0gMDtcbiAgICBmb3IgKGxldCBpID0gMDsgaSA8IHN0ci5sZW5ndGg7IGkrKykge1xuICAgICAgICBoYXNoID0gKChoYXNoIDw8IDUpIC0gaGFzaCkgKyBzdHIuY2hhckNvZGVBdChpKTtcbiAgICAgICAgaGFzaCB8PSAwO1xuICAgIH1cbiAgICBjb25zb2xlLmxvZyhcIkhhc2ggdmFsdWUgYmVmb3JlIHJldHVybjpcIiwgaGFzaCk7XG4gICAgcmV0dXJuIGhhc2gudG9TdHJpbmcoKTtcbn1cbi8vIEZ1bmN0aW9uIHRvIGdldCBjbGlja2FibGUgZWxlbWVudHMgaW4gdGhlIHZpZXdwb3J0XG5mdW5jdGlvbiBnZXRDbGlja2FibGVFbGVtZW50c0luVmlld3BvcnQoKSB7XG4gICAgY29uc3QgY2xpY2thYmxlRWxlbWVudHMgPSBbXTsgLy8gQXJyYXkgdG8gc3RvcmUgY2xpY2thYmxlIGVsZW1lbnRzXG4gICAgLy8gU2VsZWN0IGFsbCBwb3RlbnRpYWwgY2xpY2thYmxlIGVsZW1lbnRzXG4gICAgY29uc3QgYWxsRWxlbWVudHMgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKCdhLCBidXR0b24sIFtvbmNsaWNrXSwgaW5wdXRbdHlwZT1cImJ1dHRvblwiXSwgaW5wdXRbdHlwZT1cInN1Ym1pdFwiXScpO1xuICAgIC8vIENoZWNrIGlmIGVhY2ggZWxlbWVudCBpcyBpbiB0aGUgdmlld3BvcnRcbiAgICBhbGxFbGVtZW50cy5mb3JFYWNoKChlbGVtZW50KSA9PiB7XG4gICAgICAgIGNvbnN0IHJlY3QgPSBlbGVtZW50LmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpO1xuICAgICAgICBpZiAocmVjdC50b3AgPj0gMCAmJlxuICAgICAgICAgICAgcmVjdC5sZWZ0ID49IDAgJiZcbiAgICAgICAgICAgIHJlY3QuYm90dG9tIDw9ICh3aW5kb3cuaW5uZXJIZWlnaHQgfHwgZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50LmNsaWVudEhlaWdodCkgJiZcbiAgICAgICAgICAgIHJlY3QucmlnaHQgPD0gKHdpbmRvdy5pbm5lcldpZHRoIHx8IGRvY3VtZW50LmRvY3VtZW50RWxlbWVudC5jbGllbnRXaWR0aCkpIHtcbiAgICAgICAgICAgIGNsaWNrYWJsZUVsZW1lbnRzLnB1c2goe1xuICAgICAgICAgICAgICAgIHRhZ05hbWU6IGVsZW1lbnQudGFnTmFtZSxcbiAgICAgICAgICAgICAgICBjbGFzc05hbWU6IGVsZW1lbnQuY2xhc3NOYW1lLFxuICAgICAgICAgICAgICAgIGlkOiBlbGVtZW50LmlkLFxuICAgICAgICAgICAgICAgIGlubmVyVGV4dDogZWxlbWVudC5pbm5lclRleHQudHJpbSgpLFxuICAgICAgICAgICAgICAgIG91dGVySFRNTDogZWxlbWVudC5vdXRlckhUTUwudHJpbSgpLFxuICAgICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICB9KTtcbiAgICByZXR1cm4gY2xpY2thYmxlRWxlbWVudHM7XG59XG4vLyBGdW5jdGlvbiB0byBjYXB0dXJlIGludGVyYWN0aW9uc1xuZnVuY3Rpb24gY2FwdHVyZUludGVyYWN0aW9uKGV2ZW50VHlwZSwgdGFyZ2V0LCB0aW1lc3RhbXAsIHNlbGVjdG9yLCBjbGlja2FibGVJZCwgdXJsKSB7XG4gICAgcmV0dXJuIF9fYXdhaXRlcih0aGlzLCB2b2lkIDAsIHZvaWQgMCwgZnVuY3Rpb24qICgpIHtcbiAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgIC8vIEdlbmVyYXRlIG5ldyBIVE1MIHNuYXBzaG90IElEXG4gICAgICAgICAgICBjb25zdCBjdXJyZW50U25hcHNob3RJZCA9IGdlbmVyYXRlSHRtbFNuYXBzaG90SWQoKTtcbiAgICAgICAgICAgIC8vIFNhdmUgSFRNTCBzbmFwc2hvdCBhbmQgd2FpdCBmb3IgaXQgdG8gY29tcGxldGVcbiAgICAgICAgICAgIHlpZWxkIG5ldyBQcm9taXNlKChyZXNvbHZlLCByZWplY3QpID0+IHtcbiAgICAgICAgICAgICAgICBjaHJvbWUuc3RvcmFnZS5sb2NhbC5nZXQoWydodG1sU25hcHNob3RzJ10sIChyZXN1bHQpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgaHRtbFNuYXBzaG90cyA9IHJlc3VsdC5odG1sU25hcHNob3RzIHx8IHt9O1xuICAgICAgICAgICAgICAgICAgICBodG1sU25hcHNob3RzW2N1cnJlbnRTbmFwc2hvdElkXSA9IGRvY3VtZW50LmRvY3VtZW50RWxlbWVudC5vdXRlckhUTUw7XG4gICAgICAgICAgICAgICAgICAgIGNocm9tZS5zdG9yYWdlLmxvY2FsLnNldCh7IGh0bWxTbmFwc2hvdHMgfSwgKCkgPT4ge1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGNocm9tZS5ydW50aW1lLmxhc3RFcnJvcikge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlamVjdChjaHJvbWUucnVudGltZS5sYXN0RXJyb3IpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVzb2x2ZSh2b2lkIDApO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgLy8gY29uc3QgY2xpY2thYmxlRWxlbWVudHMgPSBnZXRDbGlja2FibGVFbGVtZW50c0luVmlld3BvcnQoKTtcbiAgICAgICAgICAgIGNvbnN0IGRhdGEgPSB7XG4gICAgICAgICAgICAgICAgZXZlbnRUeXBlLFxuICAgICAgICAgICAgICAgIHRpbWVzdGFtcDogdGltZXN0YW1wLFxuICAgICAgICAgICAgICAgIHRhcmdldDogdGFyZ2V0LFxuICAgICAgICAgICAgICAgIHRhcmdldE91dGVySFRNTDogdGFyZ2V0Lm91dGVySFRNTCxcbiAgICAgICAgICAgICAgICB0YXJnZXRDbGFzczogdGFyZ2V0LmNsYXNzTmFtZSxcbiAgICAgICAgICAgICAgICB0YXJnZXRJZDogdGFyZ2V0LmlkLFxuICAgICAgICAgICAgICAgIHRhcmdldFRleHQ6IHRhcmdldC5pbm5lclRleHQgfHwgdGFyZ2V0LnZhbHVlIHx8ICcnLFxuICAgICAgICAgICAgICAgIGh0bWxTbmFwc2hvdElkOiBjdXJyZW50U25hcHNob3RJZCxcbiAgICAgICAgICAgICAgICAvLyBjbGlja2FibGVFbGVtZW50czogY2xpY2thYmxlRWxlbWVudHMsXG4gICAgICAgICAgICAgICAgc2VsZWN0b3I6IHNlbGVjdG9yIHx8ICcnLFxuICAgICAgICAgICAgICAgIGNsaWNrYWJsZUlkOiBjbGlja2FibGVJZCB8fCAnJyxcbiAgICAgICAgICAgICAgICB1cmw6IHVybCB8fCAnJyxcbiAgICAgICAgICAgIH07XG4gICAgICAgICAgICB5aWVsZCBjaHJvbWUucnVudGltZS5zZW5kTWVzc2FnZSh7IGFjdGlvbjogJ3NhdmVEYXRhJywgZGF0YSB9KTtcbiAgICAgICAgfVxuICAgICAgICBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoYEVycm9yIGR1cmluZyAke2V2ZW50VHlwZX0gZXZlbnQgaGFuZGxpbmc6YCwgZXJyb3IpO1xuICAgICAgICB9XG4gICAgfSk7XG59XG4vLyBDYXB0dXJlIHNjcm9sbCBpbnRlcmFjdGlvbnNcbmRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoJ3Njcm9sbCcsIChldmVudCkgPT4gX19hd2FpdGVyKHZvaWQgMCwgdm9pZCAwLCB2b2lkIDAsIGZ1bmN0aW9uKiAoKSB7XG4gICAgdHJ5IHtcbiAgICAgICAgY29uc3QgY3VycmVudFRpbWUgPSBEYXRlLm5vdygpO1xuICAgICAgICBpZiAoY3VycmVudFRpbWUgLSBsYXN0U2Nyb2xsVGltZSA+PSBTQ1JPTExfVEhSRVNIT0xEKSB7XG4gICAgICAgICAgICBsYXN0U2Nyb2xsVGltZSA9IGN1cnJlbnRUaW1lO1xuICAgICAgICAgICAgY29uc3QgdGltZXN0YW1wID0gbmV3IERhdGUoKS50b0lTT1N0cmluZygpO1xuICAgICAgICAgICAgeWllbGQgY2FwdHVyZUludGVyYWN0aW9uKCdzY3JvbGwnLCBldmVudC50YXJnZXQsIHRpbWVzdGFtcCwgJycsICcnLCAnJyk7XG4gICAgICAgICAgICB5aWVsZCBjYXB0dXJlU2NyZWVuc2hvdCh0aW1lc3RhbXApO1xuICAgICAgICB9XG4gICAgfVxuICAgIGNhdGNoIChlcnJvcikge1xuICAgICAgICBjb25zb2xlLmVycm9yKCdFcnJvciBkdXJpbmcgc2Nyb2xsIGV2ZW50IGhhbmRsaW5nOicsIGVycm9yKTtcbiAgICB9XG59KSk7XG5kb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKFwiYmx1clwiLCAoZXZlbnQpID0+IF9fYXdhaXRlcih2b2lkIDAsIHZvaWQgMCwgdm9pZCAwLCBmdW5jdGlvbiogKCkge1xuICAgIGNvbnN0IHRhcmdldCA9IGV2ZW50LnRhcmdldDtcbiAgICBpZiAodGFyZ2V0ICYmXG4gICAgICAgICgodGFyZ2V0LnRhZ05hbWUgPT09IFwiSU5QVVRcIiAmJiB0YXJnZXQudHlwZSA9PT0gXCJ0ZXh0XCIpIHx8XG4gICAgICAgICAgICB0YXJnZXQudGFnTmFtZSA9PT0gXCJURVhUQVJFQVwiKSkge1xuICAgICAgICBjb25zdCB0aW1lc3RhbXAgPSBuZXcgRGF0ZSgpLnRvSVNPU3RyaW5nKCk7XG4gICAgICAgIHlpZWxkIGNhcHR1cmVTY3JlZW5zaG90KHRpbWVzdGFtcCk7XG4gICAgICAgIHlpZWxkIGNhcHR1cmVJbnRlcmFjdGlvbihcImlucHV0XCIsIHRhcmdldCwgdGltZXN0YW1wLCAnJywgJycsICcnKTtcbiAgICB9XG59KSwgdHJ1ZSk7XG4vLyBDYXB0dXJlIGNsaWNrIGludGVyYWN0aW9uc1xuZnVuY3Rpb24gZ2V0VW5pcXVlU2VsZWN0b3IoZWxlbWVudCkge1xuICAgIGlmIChlbGVtZW50LmlkKSB7XG4gICAgICAgIHJldHVybiBgIyR7ZWxlbWVudC5pZH1gO1xuICAgIH1cbiAgICBpZiAoZWxlbWVudC5jbGFzc05hbWUpIHtcbiAgICAgICAgY29uc3QgY2xhc3NOYW1lID0gZWxlbWVudC5jbGFzc05hbWUudHJpbSgpLnNwbGl0KC9cXHMrLykuam9pbignLicpO1xuICAgICAgICByZXR1cm4gYCR7ZWxlbWVudC50YWdOYW1lLnRvTG93ZXJDYXNlKCl9LiR7Y2xhc3NOYW1lfWA7XG4gICAgfVxuICAgIHJldHVybiBlbGVtZW50LnRhZ05hbWUudG9Mb3dlckNhc2UoKTtcbn1cbmZ1bmN0aW9uIGdldEZ1bGxTZWxlY3RvcihlbGVtZW50KSB7XG4gICAgbGV0IHBhdGggPSBbXTtcbiAgICB3aGlsZSAoZWxlbWVudC5wYXJlbnRFbGVtZW50KSB7XG4gICAgICAgIHBhdGgudW5zaGlmdChnZXRVbmlxdWVTZWxlY3RvcihlbGVtZW50KSk7XG4gICAgICAgIGVsZW1lbnQgPSBlbGVtZW50LnBhcmVudEVsZW1lbnQ7XG4gICAgfVxuICAgIHJldHVybiBwYXRoLmpvaW4oJyA+ICcpO1xufVxuLy8gZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCAoZXZlbnQpID0+IHtcbi8vICAgICB0cnkge1xuLy8gICAgICAgICBmdW5jdGlvbiBmaW5kQ2xpY2thYmxlUGFyZW50KGVsZW1lbnQ6IEhUTUxFbGVtZW50IHwgbnVsbCwgZGVwdGg6IG51bWJlciA9IDApOiBIVE1MRWxlbWVudCB8IG51bGwge1xuLy8gICAgICAgICAgICAgaWYgKCFlbGVtZW50IHx8IGRlcHRoPj0yKSByZXR1cm4gbnVsbDtcbi8vICAgICAgICAgICAgIGlmIChlbGVtZW50Lmhhc0F0dHJpYnV0ZSgnZGF0YS1jbGlja2FibGUtaWQnKSkge1xuLy8gICAgICAgICAgICAgICAgIHJldHVybiBlbGVtZW50O1xuLy8gICAgICAgICAgICAgfVxuLy8gICAgICAgICAgICAgcmV0dXJuIGZpbmRDbGlja2FibGVQYXJlbnQoZWxlbWVudC5wYXJlbnRFbGVtZW50LGRlcHRoKzEpO1xuLy8gICAgICAgICB9XG4vLyAgICAgICAgIGNvbnN0IGNsaWNrYWJsZUVsZW1lbnQgPSBmaW5kQ2xpY2thYmxlUGFyZW50KGV2ZW50LnRhcmdldCBhcyBIVE1MRWxlbWVudCk7XG4vLyAgICAgICAgIGNvbnN0IGNsaWNrYWJsZUlkID0gY2xpY2thYmxlRWxlbWVudCA/IGNsaWNrYWJsZUVsZW1lbnQuZ2V0QXR0cmlidXRlKCdkYXRhLWNsaWNrYWJsZS1pZCcpIHx8ICcnIDogJyc7XG4vLyAgICAgICAgIGNvbnNvbGUubG9nKCdjbGljaycpXG4vLyAgICAgICAgIGNvbnN0IHRpbWVzdGFtcD1uZXcgRGF0ZSgpLnRvSVNPU3RyaW5nKCk7XG4vLyAgICAgICAgIGNvbnNvbGUubG9nKHRpbWVzdGFtcClcbi8vICAgICAgICAgY29uc3Qgc2VsZWN0b3I9Z2V0RnVsbFNlbGVjdG9yKGV2ZW50LnRhcmdldCk7XG4vLyAgICAgICAgIGNvbnNvbGUubG9nKCdzcmFydCBzY3JlZW5zaG90Jylcbi8vICAgICAgICAgY2FwdHVyZVNjcmVlbnNob3QodGltZXN0YW1wKTtcbi8vICAgICAgICAgY29uc29sZS5sb2coJ2VuZCBzY3JlZW5zaG90Jylcbi8vICAgICAgICAgY2FwdHVyZUludGVyYWN0aW9uKCdjbGljaycsIGV2ZW50LnRhcmdldCx0aW1lc3RhbXAsc2VsZWN0b3IsY2xpY2thYmxlSWQsJycpO1xuLy8gICAgICAgICBjb25zb2xlLmxvZygnZW5kJylcbi8vICAgICB9IGNhdGNoIChlcnJvcikge1xuLy8gICAgICAgICBjb25zb2xlLmVycm9yKCdFcnJvciBkdXJpbmcgY2xpY2sgZXZlbnQgaGFuZGxpbmc6JywgZXJyb3IpO1xuLy8gICAgIH1cbi8vIH0pO1xuLy8gRnVuY3Rpb24gdG8gY2FwdHVyZSBzY3JlZW5zaG90cyB3aXRoIHVuaXF1ZSBJRFxuZnVuY3Rpb24gY2FwdHVyZVNjcmVlbnNob3QodGltZXN0YW1wKSB7XG4gICAgcmV0dXJuIF9fYXdhaXRlcih0aGlzLCB2b2lkIDAsIHZvaWQgMCwgZnVuY3Rpb24qICgpIHtcbiAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgIC8vIEdlbmVyYXRlIGEgdW5pcXVlIHNjcmVlbnNob3QgSURcbiAgICAgICAgICAgIGNvbnN0IHNjcmVlbnNob3RJZCA9IGBzY3JlZW5zaG90XyR7dGltZXN0YW1wfWA7XG4gICAgICAgICAgICAvLyBDYXB0dXJlIHRoZSBzY3JlZW5zaG90XG4gICAgICAgICAgICB5aWVsZCBjaHJvbWUucnVudGltZS5zZW5kTWVzc2FnZSh7IGFjdGlvbjogJ2NhcHR1cmVTY3JlZW5zaG90Jywgc2NyZWVuc2hvdElkIH0pO1xuICAgICAgICB9XG4gICAgICAgIGNhdGNoIChlcnJvcikge1xuICAgICAgICAgICAgY29uc29sZS5lcnJvcignRXJyb3IgY2FwdHVyaW5nIHNjcmVlbnNob3Q6JywgZXJyb3IpO1xuICAgICAgICB9XG4gICAgfSk7XG59XG5kb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKFwiRE9NQ29udGVudExvYWRlZFwiLCAoKSA9PiB7XG4gICAgLy8gSGFuZGxlIGFsbCB0eXBlcyBvZiBvcmRlciBidXR0b25zXG4gICAgY29uc3QgcGxhY2VPcmRlckJ1dHRvbnMgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKCdpbnB1dFtpZD1cInBsYWNlT3JkZXJcIl0sIGlucHV0W2lkPVwidHVyYm8tY2hlY2tvdXQtcHlvLWJ1dHRvblwiXScpO1xuICAgIGNvbnN0IGJ1eU5vd0J1dHRvbiA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJ2lucHV0W2lkPVwiYnV5LW5vdy1idXR0b25cIl0nKTtcbiAgICBjb25zdCBzZXR1cE5vd0J1dHRvbiA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJ2J1dHRvbltpZD1cInJjeC1zdWJzY3JpYmUtc3VibWl0LWJ1dHRvbi1hbm5vdW5jZVwiXScpO1xuICAgIGNvbnN0IHByb2NlZWRUb0NoZWNrb3V0QnV0dG9uID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignaW5wdXRbbmFtZT1cInByb2NlZWRUb1JldGFpbENoZWNrb3V0XCJdJyk7XG4gICAgLy8gSGFuZGxlIEJ1eSBOb3cgYW5kIFNldCBVcCBOb3cgYnV0dG9ucyBpZiBwcmVzZW50XG4gICAgW2J1eU5vd0J1dHRvbiwgc2V0dXBOb3dCdXR0b25dLmZvckVhY2goYnV0dG9uID0+IHtcbiAgICAgICAgaWYgKGJ1dHRvbikge1xuICAgICAgICAgICAgYnV0dG9uLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCAoKSA9PiBfX2F3YWl0ZXIodm9pZCAwLCB2b2lkIDAsIHZvaWQgMCwgZnVuY3Rpb24qICgpIHtcbiAgICAgICAgICAgICAgICB2YXIgX2EsIF9iLCBfYywgX2QsIF9lO1xuICAgICAgICAgICAgICAgIHRyeSB7XG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IHByb2R1Y3RJbmZvID0ge1xuICAgICAgICAgICAgICAgICAgICAgICAgdGl0bGU6ICgoX2IgPSAoX2EgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiI3RpdGxlXCIpKSA9PT0gbnVsbCB8fCBfYSA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2EuaW5uZXJUZXh0KSA9PT0gbnVsbCB8fCBfYiA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2IudHJpbSgpKSB8fCBcIlwiLFxuICAgICAgICAgICAgICAgICAgICAgICAgcHJpY2U6ICgoX2QgPSAoX2MgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwic3Bhbi5hLXByaWNlLmFvay1hbGlnbi1jZW50ZXIucmVpbnZlbnRQcmljZVByaWNlVG9QYXlNYXJnaW4ucHJpY2VUb1BheVwiKSkgPT09IG51bGwgfHwgX2MgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9jLmlubmVyVGV4dCkgPT09IG51bGwgfHwgX2QgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9kLnRyaW0oKSkgfHwgXCJcIixcbiAgICAgICAgICAgICAgICAgICAgICAgIGFzaW46ICgoX2UgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiaW5wdXQjQVNJTlwiKSkgPT09IG51bGwgfHwgX2UgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9lLnZhbHVlKSB8fCBcIlwiLFxuICAgICAgICAgICAgICAgICAgICAgICAgb3B0aW9uczoge31cbiAgICAgICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgICAgICAgICAgLy8gR2V0IGFsbCBvcHRpb24gc2VsZWN0aW9uc1xuICAgICAgICAgICAgICAgICAgICBjb25zdCBvcHRpb25Sb3dzID0gQXJyYXkuZnJvbShkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKFwiI3R3aXN0ZXIgZGl2LmEtcm93OmhhcyhsYWJlbC5hLWZvcm0tbGFiZWwpOmhhcyhzcGFuLnNlbGVjdGlvbilcIikpO1xuICAgICAgICAgICAgICAgICAgICBvcHRpb25Sb3dzLmZvckVhY2gocm93ID0+IHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBfYSwgX2IsIF9jO1xuICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgbGFiZWwgPSAoKF9iID0gKF9hID0gcm93LnF1ZXJ5U2VsZWN0b3IoXCJsYWJlbC5hLWZvcm0tbGFiZWxcIikpID09PSBudWxsIHx8IF9hID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYS5pbm5lclRleHQpID09PSBudWxsIHx8IF9iID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYi5yZXBsYWNlKFwiOiBcIiwgXCJcIikpIHx8IFwiXCI7XG4gICAgICAgICAgICAgICAgICAgICAgICBjb25zdCB2YWx1ZSA9ICgoX2MgPSByb3cucXVlcnlTZWxlY3RvcihcInNwYW4uc2VsZWN0aW9uXCIpKSA9PT0gbnVsbCB8fCBfYyA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2MuaW5uZXJUZXh0KSB8fCBcIlwiO1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGxhYmVsICYmIHZhbHVlKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcHJvZHVjdEluZm8ub3B0aW9uc1tsYWJlbF0gPSB2YWx1ZTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKGAke2J1dHRvbi5pZH0gY2xpY2tlZCAtIFByb2R1Y3QgSW5mbzpgLCBwcm9kdWN0SW5mbyk7XG4gICAgICAgICAgICAgICAgICAgIC8vIFN0b3JlIHRoZSBwcm9kdWN0IGluZm9cbiAgICAgICAgICAgICAgICAgICAgbGV0IHJlc3VsdCA9IHlpZWxkIGNocm9tZS5zdG9yYWdlLmxvY2FsLmdldCh7IG9yZGVyRGV0YWlsczogW10gfSk7XG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IG9yZGVyRGV0YWlscyA9IHJlc3VsdC5vcmRlckRldGFpbHMgfHwgW107XG4gICAgICAgICAgICAgICAgICAgIG9yZGVyRGV0YWlscy5wdXNoKHtcbiAgICAgICAgICAgICAgICAgICAgICAgIG5hbWU6IHByb2R1Y3RJbmZvLnRpdGxlLFxuICAgICAgICAgICAgICAgICAgICAgICAgcHJpY2U6IHBhcnNlRmxvYXQocHJvZHVjdEluZm8ucHJpY2UucmVwbGFjZSgvW14wLTkuXS9nLCAnJykpLFxuICAgICAgICAgICAgICAgICAgICAgICAgYXNpbjogcHJvZHVjdEluZm8uYXNpbixcbiAgICAgICAgICAgICAgICAgICAgICAgIG9wdGlvbnM6IHByb2R1Y3RJbmZvLm9wdGlvbnNcbiAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICAgIHlpZWxkIGNocm9tZS5zdG9yYWdlLmxvY2FsLnNldCh7IG9yZGVyRGV0YWlscyB9KTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgICAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoYEVycm9yIGNhcHR1cmluZyAke2J1dHRvbi5pZH0gcHJvZHVjdCBpbmZvOmAsIGVycm9yKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KSk7XG4gICAgICAgIH1cbiAgICB9KTtcbiAgICAvLyBPcmlnaW5hbCBQbGFjZSBPcmRlciBidXR0b24gaGFuZGxpbmdcbiAgICAvLyBpZiAocGxhY2VPcmRlckJ1dHRvbnMubGVuZ3RoID4gMCkge1xuICAgIC8vICAgICAvLyBnZXQgYWxsIHByb2R1Y3QgaW5mb3JtYXRpb24sIGZpbHRlciBvdXQgaW50ZXJmZXJlbmNlIGl0ZW1zXG4gICAgLy8gICAgIGNvbnN0IGl0ZW1zID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbCgnLmxpbmVpdGVtLXRpdGxlLXRleHQnKTtcbiAgICAvLyAgICAgY29uc3Qgb3JkZXJEZXRhaWxzOiBPcmRlckRldGFpbFtdID0gW107XG4gICAgLy8gICAgIGl0ZW1zLmZvckVhY2goKGl0ZW0pID0+IHtcbiAgICAvLyAgICAgICAgIC8vIGZpbHRlciBvdXQgaW50ZXJmZXJlbmNlIGl0ZW1zXG4gICAgLy8gICAgICAgICBpZiAoaXRlbS5tYXRjaGVzKCcuYS1zaXplLWJhc2UubGluZWl0ZW0tdGl0bGUtdGV4dCcpKSB7XG4gICAgLy8gICAgICAgICAgICAgY29uc29sZS5sb2coXCJTa2lwcGluZyBpbnRlcmZlcmluZyBlbGVtZW50OlwiLCAoaXRlbSBhcyBIVE1MRWxlbWVudCkuaW5uZXJUZXh0KTtcbiAgICAvLyAgICAgICAgICAgICByZXR1cm47XG4gICAgLy8gICAgICAgICB9XG4gICAgLy8gICAgICAgICAvLyBnZXQgcHJvZHVjdCBuYW1lXG4gICAgLy8gICAgICAgICBjb25zdCBwcm9kdWN0TmFtZSA9IChpdGVtIGFzIEhUTUxFbGVtZW50KS5pbm5lclRleHQudHJpbSgpO1xuICAgIC8vICAgICAgICAgLy8gZ2V0IHByb2R1Y3QgcHJpY2VcbiAgICAvLyAgICAgICAgIGNvbnN0IHByaWNlRWxlbWVudCA9IGl0ZW0uY2xvc2VzdCgnZGl2Jyk/LnF1ZXJ5U2VsZWN0b3IoJy5saW5laXRlbS1wcmljZS10ZXh0Jyk7XG4gICAgLy8gICAgICAgICBjb25zdCBwcm9kdWN0UHJpY2UgPSBwcmljZUVsZW1lbnQgJiYgKHByaWNlRWxlbWVudCBhcyBIVE1MRWxlbWVudCkuaW5uZXJUZXh0XG4gICAgLy8gICAgICAgICAgICAgPyAocHJpY2VFbGVtZW50IGFzIEhUTUxFbGVtZW50KS5pbm5lclRleHQudHJpbSgpLnJlcGxhY2UoJyQnLCAnJylcbiAgICAvLyAgICAgICAgICAgICA6ICcwLjAwJztcbiAgICAvLyAgICAgICAgIG9yZGVyRGV0YWlscy5wdXNoKHtcbiAgICAvLyAgICAgICAgICAgICBuYW1lOiBwcm9kdWN0TmFtZSxcbiAgICAvLyAgICAgICAgICAgICBwcmljZTogcGFyc2VGbG9hdChwcm9kdWN0UHJpY2UpLFxuICAgIC8vICAgICAgICAgfSk7XG4gICAgLy8gICAgIH0pO1xuICAgIC8vICAgICAvLyBhZGQgbGlzdGVuZXIgdG8gZWFjaCBidXR0b25cbiAgICAvLyAgICAgcGxhY2VPcmRlckJ1dHRvbnMuZm9yRWFjaCgoYnV0dG9uKSA9PiB7XG4gICAgLy8gICAgICAgICBidXR0b24uYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsIGFzeW5jKGV2ZW50KSA9PiB7XG4gICAgLy8gICAgICAgICAgICAgY29uc29sZS5sb2coXCJQbGFjZSBZb3VyIE9yZGVyIGJ1dHRvbiBjbGlja2VkIVwiKTtcbiAgICAvLyAgICAgICAgICAgICBsZXQgcmVzdWx0ID0gYXdhaXQgY2hyb21lLnN0b3JhZ2UubG9jYWwuZ2V0KHtvcmRlckRldGFpbHM6W119KTtcbiAgICAvLyAgICAgICAgICAgICByZXN1bHQ9cmVzdWx0Lm9yZGVyRGV0YWlsc3x8W11cbiAgICAvLyAgICAgICAgICAgICBsZXQgc3RvcmVPcmRlckRldGFpbHMgPSByZXN1bHQuY29uY2F0KG9yZGVyRGV0YWlscyk7XG4gICAgLy8gICAgICAgICAgICAgYXdhaXQgY2hyb21lLnN0b3JhZ2UubG9jYWwuc2V0KHsgb3JkZXJEZXRhaWxzOnN0b3JlT3JkZXJEZXRhaWxzIH0pO1xuICAgIC8vICAgICAgICAgfSk7XG4gICAgLy8gICAgIH0pO1xuICAgIC8vIH1cbiAgICBpZiAocHJvY2VlZFRvQ2hlY2tvdXRCdXR0b24pIHtcbiAgICAgICAgcHJvY2VlZFRvQ2hlY2tvdXRCdXR0b24uYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsIChldmVudCkgPT4gX19hd2FpdGVyKHZvaWQgMCwgdm9pZCAwLCB2b2lkIDAsIGZ1bmN0aW9uKiAoKSB7XG4gICAgICAgICAgICB2YXIgX2EsIF9iLCBfYztcbiAgICAgICAgICAgIHRyeSB7XG4gICAgICAgICAgICAgICAgY29uc3Qgc2VsZWN0ZWRJdGVtcyA9IFtdO1xuICAgICAgICAgICAgICAgIGNvbnN0IGNhcnRJdGVtcyA9IEFycmF5LmZyb20oZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbCgnW2lkXj1cInNjLWFjdGl2ZS1cIl0nKSlcbiAgICAgICAgICAgICAgICAgICAgLmZpbHRlcihpdGVtID0+IGl0ZW0uaWQgIT09ICdzYy1hY3RpdmUtY2FydCcpO1xuICAgICAgICAgICAgICAgIGZvciAoY29uc3QgaXRlbSBvZiBjYXJ0SXRlbXMpIHtcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgY2hlY2tib3ggPSBpdGVtLnF1ZXJ5U2VsZWN0b3IoJ2lucHV0W3R5cGU9XCJjaGVja2JveFwiXScpO1xuICAgICAgICAgICAgICAgICAgICBpZiAoY2hlY2tib3ggJiYgY2hlY2tib3guY2hlY2tlZCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgcHJvZHVjdExpbmsgPSBpdGVtLnF1ZXJ5U2VsZWN0b3IoJy5zYy1pdGVtLXByb2R1Y3QtdGl0bGUtY29udCAuc2MtcHJvZHVjdC1saW5rJyk7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAocHJvZHVjdExpbmspIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBmdWxsTmFtZUVsZW1lbnQgPSBwcm9kdWN0TGluay5xdWVyeVNlbGVjdG9yKCcuYS10cnVuY2F0ZS1mdWxsJyk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgbmFtZSA9ICgoX2EgPSBmdWxsTmFtZUVsZW1lbnQgPT09IG51bGwgfHwgZnVsbE5hbWVFbGVtZW50ID09PSB2b2lkIDAgPyB2b2lkIDAgOiBmdWxsTmFtZUVsZW1lbnQudGV4dENvbnRlbnQpID09PSBudWxsIHx8IF9hID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYS50cmltKCkpIHx8ICcnO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IGhyZWYgPSBwcm9kdWN0TGluay5nZXRBdHRyaWJ1dGUoJ2hyZWYnKSB8fCAnJztcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBhc2luID0gKChfYiA9IGhyZWYubWF0Y2goL3Byb2R1Y3RcXC8oW0EtWjAtOV17MTB9KS8pKSA9PT0gbnVsbCB8fCBfYiA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2JbMV0pIHx8ICcnO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IHByaWNlRWxlbWVudCA9IGl0ZW0ucXVlcnlTZWxlY3RvcignLnNjLWl0ZW0tcHJpY2UtYmxvY2sgLmEtb2Zmc2NyZWVuJyk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgcHJpY2UgPSBwcmljZUVsZW1lbnQgP1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBwYXJzZUZsb2F0KCgoX2MgPSBwcmljZUVsZW1lbnQudGV4dENvbnRlbnQpID09PSBudWxsIHx8IF9jID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYy5yZXBsYWNlKC9bXjAtOS5dL2csICcnKSkgfHwgJzAnKSA6IDA7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc3Qgb3B0aW9ucyA9IHt9O1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IHZhcmlhdGlvbkVsZW1lbnRzID0gaXRlbS5xdWVyeVNlbGVjdG9yQWxsKCcuc2MtcHJvZHVjdC12YXJpYXRpb24nKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXJpYXRpb25FbGVtZW50cy5mb3JFYWNoKHZhcmlhdGlvbiA9PiB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBfYSwgX2IsIF9jLCBfZDtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgbGFiZWwgPSAoKF9iID0gKF9hID0gdmFyaWF0aW9uLnF1ZXJ5U2VsZWN0b3IoJy5hLXRleHQtYm9sZCcpKSA9PT0gbnVsbCB8fCBfYSA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2EudGV4dENvbnRlbnQpID09PSBudWxsIHx8IF9iID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYi50cmltKCkucmVwbGFjZSgnOicsICcnKSkgfHwgJyc7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IHZhbHVlID0gKChfZCA9IChfYyA9IHZhcmlhdGlvbi5xdWVyeVNlbGVjdG9yKCcuYS1zaXplLXNtYWxsOm5vdCguYS10ZXh0LWJvbGQpJykpID09PSBudWxsIHx8IF9jID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYy50ZXh0Q29udGVudCkgPT09IG51bGwgfHwgX2QgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9kLnRyaW0oKSkgfHwgJyc7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChsYWJlbCAmJiB2YWx1ZSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgb3B0aW9uc1tsYWJlbF0gPSB2YWx1ZTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNlbGVjdGVkSXRlbXMucHVzaCh7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG5hbWUsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFzaW4sXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHByaWNlLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBvcHRpb25zXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgaWYgKHNlbGVjdGVkSXRlbXMubGVuZ3RoID4gMCkge1xuICAgICAgICAgICAgICAgICAgICBsZXQgcmVzdWx0ID0geWllbGQgY2hyb21lLnN0b3JhZ2UubG9jYWwuZ2V0KHsgb3JkZXJEZXRhaWxzOiBbXSB9KTtcbiAgICAgICAgICAgICAgICAgICAgY29uc3Qgb3JkZXJEZXRhaWxzID0gcmVzdWx0Lm9yZGVyRGV0YWlscyB8fCBbXTtcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgdXBkYXRlZE9yZGVyRGV0YWlscyA9IG9yZGVyRGV0YWlscy5jb25jYXQoc2VsZWN0ZWRJdGVtcyk7XG4gICAgICAgICAgICAgICAgICAgIHlpZWxkIGNocm9tZS5zdG9yYWdlLmxvY2FsLnNldCh7IG9yZGVyRGV0YWlsczogdXBkYXRlZE9yZGVyRGV0YWlscyB9KTtcbiAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coJ1N0b3JlZCBzZWxlY3RlZCBjYXJ0IGl0ZW1zOicsIHNlbGVjdGVkSXRlbXMpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGNhdGNoIChlcnJvcikge1xuICAgICAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoJ0Vycm9yIGNhcHR1cmluZyBzZWxlY3RlZCBjYXJ0IGl0ZW1zOicsIGVycm9yKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSkpO1xuICAgIH1cbn0pO1xuY2hyb21lLnJ1bnRpbWUub25NZXNzYWdlLmFkZExpc3RlbmVyKChtZXNzYWdlLCBzZW5kZXIsIHNlbmRSZXNwb25zZSkgPT4ge1xuICAgIGlmIChtZXNzYWdlLmFjdGlvbiA9PT0gJ2dldEhUTUwnKSB7XG4gICAgICAgIGNvbnN0IGh0bWxDb250ZW50ID0gZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50Lm91dGVySFRNTDtcbiAgICAgICAgc2VuZFJlc3BvbnNlKHsgaHRtbDogaHRtbENvbnRlbnQgfSk7XG4gICAgfVxuICAgIHJldHVybiB0cnVlO1xufSk7XG4iXSwibmFtZXMiOlsicHJvY2Vzc0VsZW1lbnQiLCJlbGVtZW50IiwicmVjaXBlIiwicGFyZW50TmFtZSIsIm50aENoaWxkIiwidGFnTmFtZSIsInRhZ19uYW1lIiwidG9Mb3dlckNhc2UiLCJlbmRzV2l0aCIsInNsaWNlIiwibmV3RWxlbWVudCIsImRvY3VtZW50IiwiY3JlYXRlRWxlbWVudCIsImVsZW1lbnRUZXh0IiwidGV4dF9zZWxlY3RvciIsInRleHRFbGVtZW50IiwicXVlcnlTZWxlY3RvciIsImlubmVyVGV4dCIsInRleHRDb250ZW50IiwidGV4dF9qcyIsImV2YWwiLCJhZGRfdGV4dCIsInJlcGxhY2UiLCJ0cmltIiwidGV4dF9mb3JtYXQiLCJlbGVtZW50TmFtZSIsIm5hbWUiLCJ0b1N0cmluZyIsInNldEF0dHJpYnV0ZSIsImNsaWNrYWJsZSIsIkVycm9yIiwiY2xpY2tfZWxlbWVudCIsImNsaWNrX3NlbGVjdG9yIiwiY29uc29sZSIsImxvZyIsIndpbmRvdyIsImNsaWNrYWJsZV9yZWNpcGVzIiwiaW5wdXRUeXBlIiwiZ2V0QXR0cmlidXRlIiwiaW5jbHVkZXMiLCJ2YWx1ZSIsImNoZWNrZWQiLCJpbnB1dF9yZWNpcGVzIiwib3B0aW9ucyIsInF1ZXJ5U2VsZWN0b3JBbGwiLCJmb3JFYWNoIiwib3B0aW9uIiwib3B0aW9uVmFsdWUiLCJvcHRpb25OYW1lIiwibmV3T3B0aW9uIiwic2VsZWN0ZWQiLCJhcHBlbmRDaGlsZCIsImF0dHJzVG9Db3B5IiwiYXR0ciIsImtlZXBfYXR0ciIsImtleSIsIm92ZXJyaWRlX2F0dHIiLCJjaGlsZHJlbiIsImxlbmd0aCIsImNoaWxkUmVjaXBlIiwic2VsZWN0b3IiLCJkaXJlY3RfY2hpbGQiLCJjaGlsZEVsZW1lbnRzIiwiY2hpbGRFbGVtZW50IiwiaW5kZXgiLCJjaGlsZE5vZGUiLCJpbnNlcnRfc3BsaXRfbWFya2VyIiwiaW5zZXJ0X3NwbGl0X21hcmtlcl9ldmVyeSIsInNwbGl0TWFya2VyIiwiZW1wdHlfbWVzc2FnZSIsImVtcHR5VGV4dE5vZGUiLCJjcmVhdGVUZXh0Tm9kZSIsIl9fd2VicGFja19tb2R1bGVfY2FjaGVfXyIsIl9fd2VicGFja19yZXF1aXJlX18iLCJtb2R1bGVJZCIsImNhY2hlZE1vZHVsZSIsInVuZGVmaW5lZCIsImV4cG9ydHMiLCJtb2R1bGUiLCJfX3dlYnBhY2tfbW9kdWxlc19fIiwiZCIsImRlZmluaXRpb24iLCJvIiwiT2JqZWN0IiwiZGVmaW5lUHJvcGVydHkiLCJlbnVtZXJhYmxlIiwiZ2V0Iiwib2JqIiwicHJvcCIsInByb3RvdHlwZSIsImhhc093blByb3BlcnR5IiwiY2FsbCIsIl9fYXdhaXRlciIsInRoaXNBcmciLCJfYXJndW1lbnRzIiwiUCIsImdlbmVyYXRvciIsIlByb21pc2UiLCJyZXNvbHZlIiwicmVqZWN0IiwiZnVsZmlsbGVkIiwic3RlcCIsIm5leHQiLCJlIiwicmVqZWN0ZWQiLCJyZXN1bHQiLCJkb25lIiwidGhlbiIsImFwcGx5IiwibGFzdFNjcm9sbFRpbWUiLCJTQ1JPTExfVEhSRVNIT0xEIiwiZ2VuZXJhdGVTZWxlY3RvciIsImlkIiwicGF0aCIsImN1cnJlbnQiLCJib2R5IiwicGFyZW50RWxlbWVudCIsImNsYXNzTmFtZSIsInNpYmxpbmciLCJudGgiLCJwcmV2aW91c0VsZW1lbnRTaWJsaW5nIiwidW5zaGlmdCIsImpvaW4iLCJzZXR1cENsaWNrSW50ZXJjZXB0aW9uIiwib3JpZ2luYWxBZGRFdmVudExpc3RlbmVyIiwiRXZlbnRUYXJnZXQiLCJhZGRFdmVudExpc3RlbmVyIiwidHlwZSIsImxpc3RlbmVyIiwid3JhcHBlZExpc3RlbmVyIiwiZXZlbnQiLCJ0aW1lc3RhbXAiLCJEYXRlIiwidG9JU09TdHJpbmciLCJjYXB0dXJlSW50ZXJhY3Rpb24iLCJ0aGlzIiwibG9jYXRpb24iLCJocmVmIiwiZXJyb3IiLCJoYW5kbGVFdmVudCIsImdlbmVyYXRlSHRtbFNuYXBzaG90SWQiLCJ1cmwiLCJoYXNoQ29kZSIsInN0ciIsImhhc2giLCJpIiwiY2hhckNvZGVBdCIsImdldENsaWNrYWJsZUVsZW1lbnRzSW5WaWV3cG9ydCIsImNsaWNrYWJsZUVsZW1lbnRzIiwicmVjdCIsImdldEJvdW5kaW5nQ2xpZW50UmVjdCIsInRvcCIsImxlZnQiLCJib3R0b20iLCJpbm5lckhlaWdodCIsImRvY3VtZW50RWxlbWVudCIsImNsaWVudEhlaWdodCIsInJpZ2h0IiwiaW5uZXJXaWR0aCIsImNsaWVudFdpZHRoIiwicHVzaCIsIm91dGVySFRNTCIsImV2ZW50VHlwZSIsInRhcmdldCIsImNsaWNrYWJsZUlkIiwiY3VycmVudFNuYXBzaG90SWQiLCJjaHJvbWUiLCJzdG9yYWdlIiwibG9jYWwiLCJodG1sU25hcHNob3RzIiwic2V0IiwicnVudGltZSIsImxhc3RFcnJvciIsImRhdGEiLCJ0YXJnZXRPdXRlckhUTUwiLCJ0YXJnZXRDbGFzcyIsInRhcmdldElkIiwidGFyZ2V0VGV4dCIsImh0bWxTbmFwc2hvdElkIiwic2VuZE1lc3NhZ2UiLCJhY3Rpb24iLCJnZXRVbmlxdWVTZWxlY3RvciIsInNwbGl0IiwiZ2V0RnVsbFNlbGVjdG9yIiwiY2FwdHVyZVNjcmVlbnNob3QiLCJzY3JlZW5zaG90SWQiLCJyZXNwb25zZSIsInJvb3RFbGVtZW50IiwibmV3Um9vdCIsImN1cnJlbnRUaW1lIiwibm93IiwiYnV5Tm93QnV0dG9uIiwic2V0dXBOb3dCdXR0b24iLCJwcm9jZWVkVG9DaGVja291dEJ1dHRvbiIsImJ1dHRvbiIsIl9hIiwiX2IiLCJfYyIsIl9kIiwiX2UiLCJwcm9kdWN0SW5mbyIsInRpdGxlIiwicHJpY2UiLCJhc2luIiwiQXJyYXkiLCJmcm9tIiwicm93IiwibGFiZWwiLCJvcmRlckRldGFpbHMiLCJwYXJzZUZsb2F0Iiwic2VsZWN0ZWRJdGVtcyIsImNhcnRJdGVtcyIsImZpbHRlciIsIml0ZW0iLCJjaGVja2JveCIsInByb2R1Y3RMaW5rIiwiZnVsbE5hbWVFbGVtZW50IiwibWF0Y2giLCJwcmljZUVsZW1lbnQiLCJ2YXJpYXRpb24iLCJ1cGRhdGVkT3JkZXJEZXRhaWxzIiwiY29uY2F0Iiwib25NZXNzYWdlIiwiYWRkTGlzdGVuZXIiLCJtZXNzYWdlIiwic2VuZGVyIiwic2VuZFJlc3BvbnNlIiwiaHRtbCJdLCJzb3VyY2VSb290IjoiIn0=