(()=>{"use strict";var __awaiter=function(e,t,n,r){return new(n||(n=Promise))((function(o,i){function c(e){try{a(r.next(e))}catch(e){i(e)}}function l(e){try{a(r.throw(e))}catch(e){i(e)}}function a(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(c,l)}a((r=r.apply(e,t||[])).next())}))};let lastScrollTime=0;const SCROLL_THRESHOLD=1500;let htmlSnapshotId=null;function processElement(element,recipe,parentName="",nthChild=0){let tagName=recipe.tag_name||element.tagName.toLowerCase();tagName.endsWith("_")&&(tagName=tagName.slice(0,-1));const newElement=document.createElement(tagName);let elementText="";if(recipe.text_selector){const e=element.querySelector(recipe.text_selector);e&&(elementText=e.innerText||e.textContent||"")}else recipe.text_js?elementText=eval(recipe.text_js):recipe.add_text&&(elementText=element.innerText||element.textContent||"");elementText=elementText.replace(/\s+/g," ").trim(),recipe.text_format&&elementText&&(elementText=recipe.text_format.replace("{}",elementText)),elementText&&recipe.add_text&&(newElement.textContent=elementText);let elementName="";if(recipe.name&&("from_text"===recipe.name?(elementName=parentName?parentName+".":"",elementName+=elementText.toLowerCase().replace(/[^\w]+/g,"_")):"from_nth_child"===recipe.name?(elementName=parentName?parentName+".":"",elementName+=nthChild.toString()):(elementName=parentName?parentName+".":"",elementName+=recipe.name),newElement.setAttribute("name",elementName),parentName=elementName),recipe.clickable){if(!recipe.name)throw new Error("clickable element must have a name");let e;e=recipe.click_selector?element.querySelector(recipe.click_selector):element,e?e.setAttribute("data-clickable-id",elementName):console.log("click-element not found",element,recipe),window.clickable_recipes||(window.clickable_recipes={}),window.clickable_recipes[elementName]=recipe}if("input"===tagName){const e=element.getAttribute("type");["text","number"].includes(e)?(newElement.setAttribute("value",element.value),element.setAttribute("data-input-id",elementName)):"checkbox"===e?newElement.setAttribute("checked",element.checked.toString()):"radio"===e&&(newElement.setAttribute("checked",element.checked.toString()),element.setAttribute("data-clickable-id",elementName)),window.input_recipes||(window.input_recipes={}),window.input_recipes[elementName]=recipe}if("select"===tagName){element.setAttribute("data-select-id",elementName);const e=element.querySelectorAll("option");e.forEach((e=>{const t=e.getAttribute("value")||e.textContent.trim(),n=elementName+"."+t,r=document.createElement("option");r.textContent=e.textContent,r.setAttribute("value",t),r.setAttribute("name",n),r.setAttribute("selected",e.selected.toString()),e.setAttribute("data-clickable-id",n),newElement.appendChild(r)}))}const attrsToCopy=["alt","title","type","value","role","aria-label","aria-hidden","aria-selected"];if(attrsToCopy.forEach((e=>{const t=element.getAttribute(e);t&&newElement.setAttribute(e,t)})),recipe.keep_attr)for(const e in recipe.keep_attr){const t=element.getAttribute(e);t&&newElement.setAttribute(e,t)}if(recipe.class&&newElement.setAttribute("class",recipe.class),recipe.id&&newElement.setAttribute("id",recipe.id),recipe.override_attr)for(const key in recipe.override_attr)newElement.setAttribute(key,eval(recipe.override_attr[key]));if(recipe.children&&recipe.children.length>0)for(const e of recipe.children){const t=e.direct_child?`:scope > ${e.selector}`:e.selector,n=element.querySelectorAll(t);n.forEach(((t,n)=>{const r=processElement(t,e,parentName,n);if(newElement.appendChild(r),e.insert_split_marker&&n%(e.insert_split_marker_every||1)==0){const e=document.createElement("split-marker");newElement.appendChild(e)}if(e.insert_split_marker){const e=document.createElement("split-marker");newElement.appendChild(e)}else console.log("no split marker")}))}if(recipe.empty_message&&0===newElement.children.length){const e=document.createTextNode(recipe.empty_message);newElement.appendChild(e)}return newElement}function generateHtmlSnapshotId(){const e=window.location.href,t=(new Date).toISOString();return`html_${hashCode(e)}_${t}`}function hashCode(e){let t=0;for(let n=0;n<e.length;n++)t=(t<<5)-t+e.charCodeAt(n),t|=0;return console.log("Hash value before return:",t),t.toString()}function getClickableElementsInViewport(){const e=[];return document.querySelectorAll('a, button, [onclick], input[type="button"], input[type="submit"]').forEach((t=>{const n=t.getBoundingClientRect();n.top>=0&&n.left>=0&&n.bottom<=(window.innerHeight||document.documentElement.clientHeight)&&n.right<=(window.innerWidth||document.documentElement.clientWidth)&&e.push({tagName:t.tagName,className:t.className,id:t.id,innerText:t.innerText.trim(),outerHTML:t.outerHTML.trim()})})),e}function captureInteraction(e,t,n,r,o,i){return __awaiter(this,void 0,void 0,(function*(){try{const c=generateHtmlSnapshotId();yield new Promise(((e,t)=>{chrome.storage.local.get(["htmlSnapshots"],(n=>{const r=n.htmlSnapshots||{};r[c]=document.documentElement.outerHTML,chrome.storage.local.set({htmlSnapshots:r},(()=>{chrome.runtime.lastError?t(chrome.runtime.lastError):e(void 0)}))}))}));const l={eventType:e,timestamp:n,target:t,targetOuterHTML:t.outerHTML,targetClass:t.className,targetId:t.id,targetText:t.innerText||t.value||"",htmlSnapshotId:c,selector:r||"",clickableId:o||"",url:i||""};yield chrome.runtime.sendMessage({action:"saveData",data:l})}catch(t){console.error(`Error during ${e} event handling:`,t)}}))}function getUniqueSelector(e){if(e.id)return`#${e.id}`;if(e.className){const t=e.className.trim().split(/\s+/).join(".");return`${e.tagName.toLowerCase()}.${t}`}return e.tagName.toLowerCase()}function getFullSelector(e){let t=[];for(;e.parentElement;)t.unshift(getUniqueSelector(e)),e=e.parentElement;return t.join(" > ")}function captureScreenshot(e){return __awaiter(this,void 0,void 0,(function*(){try{const t=`screenshot_${e}`;yield chrome.runtime.sendMessage({action:"captureScreenshot",screenshotId:t})}catch(e){console.error("Error capturing screenshot:",e)}}))}document.addEventListener("DOMContentLoaded",(()=>__awaiter(void 0,void 0,void 0,(function*(){console.log("DOMContentLoaded");const e=window.location.href;try{const t=yield new Promise((t=>{chrome.runtime.sendMessage({action:"getRecipe",url:e},t)}));if(console.log("response"),t&&t.recipe){const e=t.recipe,n=document.querySelector(e.selector);if(n){const t=processElement(n,e);console.log(t.outerHTML)}}}catch(e){console.error("Error initializing clickable elements:",e)}try{const t=(new Date).toISOString();captureScreenshot(t),captureInteraction("navigate","",t,"","",e)}catch(e){console.error("Error capturing screenshot:",e)}})))),document.addEventListener("scroll",(e=>__awaiter(void 0,void 0,void 0,(function*(){try{const t=Date.now();if(t-lastScrollTime>=SCROLL_THRESHOLD){lastScrollTime=t;const n=(new Date).toISOString();yield captureInteraction("scroll",e.target,n,"","",""),yield captureScreenshot(n)}}catch(e){console.error("Error during scroll event handling:",e)}})))),document.addEventListener("blur",(e=>__awaiter(void 0,void 0,void 0,(function*(){if(e.target&&"INPUT"===e.target.tagName||"TEXTAREA"===e.target.tagName){const t=e.target,n=(new Date).toISOString();yield captureScreenshot(n),yield captureInteraction("input",t,n,"","","")}}))),!0),document.addEventListener("click",(e=>{try{function t(e,n=0){return!e||n>=2?null:e.hasAttribute("data-clickable-id")?e:t(e.parentElement,n+1)}const n=t(e.target),r=n&&n.getAttribute("data-clickable-id")||"";console.log("click");const o=(new Date).toISOString();console.log(o);const i=getFullSelector(e.target);console.log("srart screenshot"),captureScreenshot(o),console.log("end screenshot"),captureInteraction("click",e.target,o,i,r,""),console.log("end")}catch(c){console.error("Error during click event handling:",c)}})),document.addEventListener("DOMContentLoaded",(()=>{const e=document.querySelectorAll('input[id="placeOrder"]');if(0===e.length)return void console.log("No Place Your Order buttons found!");const t=document.querySelectorAll(".lineitem-title-text"),n=[];t.forEach((e=>{var t;if(e.matches(".a-size-base.lineitem-title-text"))return void console.log("Skipping interfering element:",e.innerText);const r=e.innerText.trim(),o=null===(t=e.closest("div"))||void 0===t?void 0:t.querySelector(".lineitem-price-text"),i=o&&o.innerText?o.innerText.trim().replace("$",""):"0.00";n.push({name:r,price:parseFloat(i)})})),e.forEach((e=>{e.addEventListener("click",(e=>__awaiter(void 0,void 0,void 0,(function*(){console.log("Place Your Order button clicked!");let e=yield chrome.storage.local.get({orderDetails:[]});e=e.orderDetails||[];let t=e.concat(n);yield chrome.storage.local.set({orderDetails:t})}))))}))}))})();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,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LElBQUksc0NBSWhCLE1BQU02RyxFQUFRcEksU0FBU2dDLGlCQUFpQix3QkFDbENxRyxFQUFlLEdBQ3JCRCxFQUFNbkcsU0FBU3FHLElBQ1gsSUFBSUMsRUFFSixHQUFJRCxFQUFLRSxRQUFRLG9DQUViLFlBREFsSCxRQUFRQyxJQUFJLGdDQUFpQytHLEVBQUtoSSxXQUl0RCxNQUFNbUksRUFBY0gsRUFBS2hJLFVBQVVNLE9BRTdCOEgsRUFBOEMsUUFBOUJILEVBQUtELEVBQUtLLFFBQVEsY0FBMkIsSUFBUEosT0FBZ0IsRUFBU0EsRUFBR2xJLGNBQWMsd0JBQ2hHdUksRUFBZUYsR0FBZ0JBLEVBQWFwSSxVQUM1Q29JLEVBQWFwSSxVQUFVTSxPQUFPRCxRQUFRLElBQUssSUFDM0MsT0FDTjBILEVBQWFoRCxLQUFLLENBQ2R0RSxLQUFNMEgsRUFDTkksTUFBT0MsV0FBV0YsSUFDcEIsSUFHTlQsRUFBa0JsRyxTQUFTOEcsSUFDdkJBLEVBQU92QixpQkFBaUIsU0FBVUksR0FBVTVKLGVBQVUsT0FBUSxPQUFRLEdBQVEsWUFDMUVzRCxRQUFRQyxJQUFJLG9DQUNaLElBQUl6QyxRQUFlaUgsT0FBT0MsUUFBUUMsTUFBTUMsSUFBSSxDQUFFbUMsYUFBYyxLQUM1RHZKLEVBQVNBLEVBQU91SixjQUFnQixHQUNoQyxJQUFJVyxFQUFvQmxLLEVBQU9tSyxPQUFPWixTQUNoQ3RDLE9BQU9DLFFBQVFDLE1BQU1HLElBQUksQ0FBRWlDLGFBQWNXLEdBQ25ELEtBQUcsR0FDTCxHIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vY2hyb21lLWV4dGVuc2lvbi10eXBlc2NyaXB0LXN0YXJ0ZXIvLi9zcmMvY29udGVudF9zY3JpcHQudHMiXSwic291cmNlc0NvbnRlbnQiOlsidmFyIF9fYXdhaXRlciA9ICh0aGlzICYmIHRoaXMuX19hd2FpdGVyKSB8fCBmdW5jdGlvbiAodGhpc0FyZywgX2FyZ3VtZW50cywgUCwgZ2VuZXJhdG9yKSB7XG4gICAgZnVuY3Rpb24gYWRvcHQodmFsdWUpIHsgcmV0dXJuIHZhbHVlIGluc3RhbmNlb2YgUCA/IHZhbHVlIDogbmV3IFAoZnVuY3Rpb24gKHJlc29sdmUpIHsgcmVzb2x2ZSh2YWx1ZSk7IH0pOyB9XG4gICAgcmV0dXJuIG5ldyAoUCB8fCAoUCA9IFByb21pc2UpKShmdW5jdGlvbiAocmVzb2x2ZSwgcmVqZWN0KSB7XG4gICAgICAgIGZ1bmN0aW9uIGZ1bGZpbGxlZCh2YWx1ZSkgeyB0cnkgeyBzdGVwKGdlbmVyYXRvci5uZXh0KHZhbHVlKSk7IH0gY2F0Y2ggKGUpIHsgcmVqZWN0KGUpOyB9IH1cbiAgICAgICAgZnVuY3Rpb24gcmVqZWN0ZWQodmFsdWUpIHsgdHJ5IHsgc3RlcChnZW5lcmF0b3JbXCJ0aHJvd1wiXSh2YWx1ZSkpOyB9IGNhdGNoIChlKSB7IHJlamVjdChlKTsgfSB9XG4gICAgICAgIGZ1bmN0aW9uIHN0ZXAocmVzdWx0KSB7IHJlc3VsdC5kb25lID8gcmVzb2x2ZShyZXN1bHQudmFsdWUpIDogYWRvcHQocmVzdWx0LnZhbHVlKS50aGVuKGZ1bGZpbGxlZCwgcmVqZWN0ZWQpOyB9XG4gICAgICAgIHN0ZXAoKGdlbmVyYXRvciA9IGdlbmVyYXRvci5hcHBseSh0aGlzQXJnLCBfYXJndW1lbnRzIHx8IFtdKSkubmV4dCgpKTtcbiAgICB9KTtcbn07XG5sZXQgbGFzdFNjcm9sbFRpbWUgPSAwOyAvLyBUcmFjayBsYXN0IHNjcm9sbCB0aW1lc3RhbXBcbmNvbnN0IFNDUk9MTF9USFJFU0hPTEQgPSAxNTAwOyAvLyBNaW5pbXVtIHRpbWUgaW4gbXMgYmV0d2VlbiBzY3JlZW5zaG90cyBmb3Igc2Nyb2xsIGFjdGlvbnNcbmxldCBodG1sU25hcHNob3RJZCA9IG51bGw7XG5mdW5jdGlvbiBwcm9jZXNzRWxlbWVudChlbGVtZW50LCByZWNpcGUsIHBhcmVudE5hbWUgPSBcIlwiLCBudGhDaGlsZCA9IDApIHtcbiAgICAvLyBDcmVhdGUgYSBuZXcgZWxlbWVudCB1c2luZyB0aGUgRE9NIEFQSVxuICAgIGxldCB0YWdOYW1lID0gcmVjaXBlLnRhZ19uYW1lIHx8IGVsZW1lbnQudGFnTmFtZS50b0xvd2VyQ2FzZSgpO1xuICAgIC8vIEhhbmRsZSB1bmRlcnNjb3JlZCB0YWdzXG4gICAgaWYgKHRhZ05hbWUuZW5kc1dpdGgoXCJfXCIpKSB7XG4gICAgICAgIHRhZ05hbWUgPSB0YWdOYW1lLnNsaWNlKDAsIC0xKTtcbiAgICB9XG4gICAgY29uc3QgbmV3RWxlbWVudCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQodGFnTmFtZSk7XG4gICAgLy8gRXh0cmFjdCB0ZXh0IGNvbnRlbnQgYmFzZWQgb24gdGhlIHJlY2lwZVxuICAgIGxldCBlbGVtZW50VGV4dCA9IFwiXCI7XG4gICAgaWYgKHJlY2lwZS50ZXh0X3NlbGVjdG9yKSB7XG4gICAgICAgIGNvbnN0IHRleHRFbGVtZW50ID0gZWxlbWVudC5xdWVyeVNlbGVjdG9yKHJlY2lwZS50ZXh0X3NlbGVjdG9yKTtcbiAgICAgICAgaWYgKHRleHRFbGVtZW50KSB7XG4gICAgICAgICAgICBlbGVtZW50VGV4dCA9IHRleHRFbGVtZW50LmlubmVyVGV4dCB8fCB0ZXh0RWxlbWVudC50ZXh0Q29udGVudCB8fCBcIlwiO1xuICAgICAgICB9XG4gICAgfVxuICAgIGVsc2UgaWYgKHJlY2lwZS50ZXh0X2pzKSB7XG4gICAgICAgIGVsZW1lbnRUZXh0ID0gZXZhbChyZWNpcGUudGV4dF9qcyk7XG4gICAgfVxuICAgIGVsc2UgaWYgKHJlY2lwZS5hZGRfdGV4dCkge1xuICAgICAgICBlbGVtZW50VGV4dCA9IGVsZW1lbnQuaW5uZXJUZXh0IHx8IGVsZW1lbnQudGV4dENvbnRlbnQgfHwgXCJcIjtcbiAgICB9XG4gICAgZWxlbWVudFRleHQgPSBlbGVtZW50VGV4dC5yZXBsYWNlKC9cXHMrL2csIFwiIFwiKS50cmltKCk7XG4gICAgaWYgKHJlY2lwZS50ZXh0X2Zvcm1hdCAmJiBlbGVtZW50VGV4dCkge1xuICAgICAgICBlbGVtZW50VGV4dCA9IHJlY2lwZS50ZXh0X2Zvcm1hdC5yZXBsYWNlKFwie31cIiwgZWxlbWVudFRleHQpO1xuICAgIH1cbiAgICBpZiAoZWxlbWVudFRleHQgJiYgcmVjaXBlLmFkZF90ZXh0KSB7XG4gICAgICAgIG5ld0VsZW1lbnQudGV4dENvbnRlbnQgPSBlbGVtZW50VGV4dDtcbiAgICB9XG4gICAgLy8gQnVpbGQgdGhlIG5vZGUgYXR0cmlidXRlc1xuICAgIGxldCBlbGVtZW50TmFtZSA9IFwiXCI7XG4gICAgaWYgKHJlY2lwZS5uYW1lKSB7XG4gICAgICAgIGlmIChyZWNpcGUubmFtZSA9PT0gXCJmcm9tX3RleHRcIikge1xuICAgICAgICAgICAgZWxlbWVudE5hbWUgPSBwYXJlbnROYW1lID8gcGFyZW50TmFtZSArIFwiLlwiIDogXCJcIjtcbiAgICAgICAgICAgIGVsZW1lbnROYW1lICs9IGVsZW1lbnRUZXh0LnRvTG93ZXJDYXNlKCkucmVwbGFjZSgvW15cXHddKy9nLCBcIl9cIik7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSBpZiAocmVjaXBlLm5hbWUgPT09IFwiZnJvbV9udGhfY2hpbGRcIikge1xuICAgICAgICAgICAgZWxlbWVudE5hbWUgPSBwYXJlbnROYW1lID8gcGFyZW50TmFtZSArIFwiLlwiIDogXCJcIjtcbiAgICAgICAgICAgIGVsZW1lbnROYW1lICs9IG50aENoaWxkLnRvU3RyaW5nKCk7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICBlbGVtZW50TmFtZSA9IHBhcmVudE5hbWUgPyBwYXJlbnROYW1lICsgXCIuXCIgOiBcIlwiO1xuICAgICAgICAgICAgZWxlbWVudE5hbWUgKz0gcmVjaXBlLm5hbWU7XG4gICAgICAgIH1cbiAgICAgICAgbmV3RWxlbWVudC5zZXRBdHRyaWJ1dGUoXCJuYW1lXCIsIGVsZW1lbnROYW1lKTtcbiAgICAgICAgcGFyZW50TmFtZSA9IGVsZW1lbnROYW1lO1xuICAgIH1cbiAgICAvLyBIYW5kbGUgY2xpY2thYmxlcyBhbmQgaW5wdXRzXG4gICAgaWYgKHJlY2lwZS5jbGlja2FibGUpIHtcbiAgICAgICAgaWYgKCFyZWNpcGUubmFtZSkge1xuICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwiY2xpY2thYmxlIGVsZW1lbnQgbXVzdCBoYXZlIGEgbmFtZVwiKTtcbiAgICAgICAgfVxuICAgICAgICAvLyBoYW5kbGUgY2xpY2tfc2VsZWN0b3JcbiAgICAgICAgbGV0IGNsaWNrX2VsZW1lbnQ7XG4gICAgICAgIGlmIChyZWNpcGUuY2xpY2tfc2VsZWN0b3IpIHtcbiAgICAgICAgICAgIGNsaWNrX2VsZW1lbnQgPSBlbGVtZW50LnF1ZXJ5U2VsZWN0b3IocmVjaXBlLmNsaWNrX3NlbGVjdG9yKTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIGNsaWNrX2VsZW1lbnQgPSBlbGVtZW50O1xuICAgICAgICB9XG4gICAgICAgIGlmIChjbGlja19lbGVtZW50KSB7XG4gICAgICAgICAgICBjbGlja19lbGVtZW50LnNldEF0dHJpYnV0ZShcImRhdGEtY2xpY2thYmxlLWlkXCIsIGVsZW1lbnROYW1lKTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKCdjbGljay1lbGVtZW50IG5vdCBmb3VuZCcsIGVsZW1lbnQsIHJlY2lwZSk7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKCF3aW5kb3cuY2xpY2thYmxlX3JlY2lwZXMpIHtcbiAgICAgICAgICAgIHdpbmRvdy5jbGlja2FibGVfcmVjaXBlcyA9IHt9O1xuICAgICAgICB9XG4gICAgICAgIHdpbmRvdy5jbGlja2FibGVfcmVjaXBlc1tlbGVtZW50TmFtZV0gPSByZWNpcGU7XG4gICAgfVxuICAgIGlmICh0YWdOYW1lID09PSBcImlucHV0XCIpIHtcbiAgICAgICAgY29uc3QgaW5wdXRUeXBlID0gZWxlbWVudC5nZXRBdHRyaWJ1dGUoXCJ0eXBlXCIpO1xuICAgICAgICBpZiAoW1widGV4dFwiLCBcIm51bWJlclwiXS5pbmNsdWRlcyhpbnB1dFR5cGUpKSB7XG4gICAgICAgICAgICBuZXdFbGVtZW50LnNldEF0dHJpYnV0ZShcInZhbHVlXCIsIGVsZW1lbnQudmFsdWUpO1xuICAgICAgICAgICAgZWxlbWVudC5zZXRBdHRyaWJ1dGUoXCJkYXRhLWlucHV0LWlkXCIsIGVsZW1lbnROYW1lKTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIGlmIChpbnB1dFR5cGUgPT09IFwiY2hlY2tib3hcIikge1xuICAgICAgICAgICAgbmV3RWxlbWVudC5zZXRBdHRyaWJ1dGUoXCJjaGVja2VkXCIsIGVsZW1lbnQuY2hlY2tlZC50b1N0cmluZygpKTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIGlmIChpbnB1dFR5cGUgPT09IFwicmFkaW9cIikge1xuICAgICAgICAgICAgbmV3RWxlbWVudC5zZXRBdHRyaWJ1dGUoXCJjaGVja2VkXCIsIGVsZW1lbnQuY2hlY2tlZC50b1N0cmluZygpKTtcbiAgICAgICAgICAgIGVsZW1lbnQuc2V0QXR0cmlidXRlKFwiZGF0YS1jbGlja2FibGUtaWRcIiwgZWxlbWVudE5hbWUpO1xuICAgICAgICB9XG4gICAgICAgIGlmICghd2luZG93LmlucHV0X3JlY2lwZXMpIHtcbiAgICAgICAgICAgIHdpbmRvdy5pbnB1dF9yZWNpcGVzID0ge307XG4gICAgICAgIH1cbiAgICAgICAgd2luZG93LmlucHV0X3JlY2lwZXNbZWxlbWVudE5hbWVdID0gcmVjaXBlO1xuICAgIH1cbiAgICAvLyAqKkhhbmRsZSBzZWxlY3QgZWxlbWVudHMqKlxuICAgIGlmICh0YWdOYW1lID09PSBcInNlbGVjdFwiKSB7XG4gICAgICAgIC8vIFRhZyB0aGUgc2VsZWN0IGVsZW1lbnQgd2l0aCBkYXRhLXNlbGVjdC1pZFxuICAgICAgICBlbGVtZW50LnNldEF0dHJpYnV0ZShcImRhdGEtc2VsZWN0LWlkXCIsIGVsZW1lbnROYW1lKTtcbiAgICAgICAgY29uc3Qgb3B0aW9ucyA9IGVsZW1lbnQucXVlcnlTZWxlY3RvckFsbCgnb3B0aW9uJyk7XG4gICAgICAgIG9wdGlvbnMuZm9yRWFjaCgob3B0aW9uKSA9PiB7XG4gICAgICAgICAgICBjb25zdCBvcHRpb25WYWx1ZSA9IG9wdGlvbi5nZXRBdHRyaWJ1dGUoJ3ZhbHVlJykgfHwgb3B0aW9uLnRleHRDb250ZW50LnRyaW0oKTtcbiAgICAgICAgICAgIGNvbnN0IG9wdGlvbk5hbWUgPSBlbGVtZW50TmFtZSArIFwiLlwiICsgb3B0aW9uVmFsdWU7XG4gICAgICAgICAgICBjb25zdCBuZXdPcHRpb24gPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdvcHRpb24nKTtcbiAgICAgICAgICAgIG5ld09wdGlvbi50ZXh0Q29udGVudCA9IG9wdGlvbi50ZXh0Q29udGVudDtcbiAgICAgICAgICAgIG5ld09wdGlvbi5zZXRBdHRyaWJ1dGUoJ3ZhbHVlJywgb3B0aW9uVmFsdWUpO1xuICAgICAgICAgICAgbmV3T3B0aW9uLnNldEF0dHJpYnV0ZSgnbmFtZScsIG9wdGlvbk5hbWUpO1xuICAgICAgICAgICAgbmV3T3B0aW9uLnNldEF0dHJpYnV0ZSgnc2VsZWN0ZWQnLCBvcHRpb24uc2VsZWN0ZWQudG9TdHJpbmcoKSk7XG4gICAgICAgICAgICBvcHRpb24uc2V0QXR0cmlidXRlKCdkYXRhLWNsaWNrYWJsZS1pZCcsIG9wdGlvbk5hbWUpOyAvLyBUYWcgYWN0dWFsIERPTSBvcHRpb24gZWxlbWVudFxuICAgICAgICAgICAgbmV3RWxlbWVudC5hcHBlbmRDaGlsZChuZXdPcHRpb24pO1xuICAgICAgICB9KTtcbiAgICB9XG4gICAgLy8gQ29weSBzcGVjaWZpZWQgYXR0cmlidXRlc1xuICAgIGNvbnN0IGF0dHJzVG9Db3B5ID0gW1wiYWx0XCIsIFwidGl0bGVcIiwgXCJ0eXBlXCIsIFwidmFsdWVcIiwgXCJyb2xlXCIsIFwiYXJpYS1sYWJlbFwiLCBcImFyaWEtaGlkZGVuXCIsIFwiYXJpYS1zZWxlY3RlZFwiXTtcbiAgICBhdHRyc1RvQ29weS5mb3JFYWNoKChhdHRyKSA9PiB7XG4gICAgICAgIGNvbnN0IHZhbHVlID0gZWxlbWVudC5nZXRBdHRyaWJ1dGUoYXR0cik7XG4gICAgICAgIGlmICh2YWx1ZSkge1xuICAgICAgICAgICAgbmV3RWxlbWVudC5zZXRBdHRyaWJ1dGUoYXR0ciwgdmFsdWUpO1xuICAgICAgICB9XG4gICAgfSk7XG4gICAgaWYgKHJlY2lwZS5rZWVwX2F0dHIpIHtcbiAgICAgICAgZm9yIChjb25zdCBrZXkgaW4gcmVjaXBlLmtlZXBfYXR0cikge1xuICAgICAgICAgICAgY29uc3QgdmFsdWUgPSBlbGVtZW50LmdldEF0dHJpYnV0ZShrZXkpO1xuICAgICAgICAgICAgaWYgKHZhbHVlKSB7XG4gICAgICAgICAgICAgICAgbmV3RWxlbWVudC5zZXRBdHRyaWJ1dGUoa2V5LCB2YWx1ZSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9XG4gICAgaWYgKHJlY2lwZVsnY2xhc3MnXSkge1xuICAgICAgICBuZXdFbGVtZW50LnNldEF0dHJpYnV0ZSgnY2xhc3MnLCByZWNpcGVbJ2NsYXNzJ10pO1xuICAgIH1cbiAgICBpZiAocmVjaXBlWydpZCddKSB7XG4gICAgICAgIG5ld0VsZW1lbnQuc2V0QXR0cmlidXRlKCdpZCcsIHJlY2lwZVsnaWQnXSk7XG4gICAgfVxuICAgIC8vIE92ZXJyaWRlIGF0dHJpYnV0ZXMgaWYgc3BlY2lmaWVkXG4gICAgaWYgKHJlY2lwZS5vdmVycmlkZV9hdHRyKSB7XG4gICAgICAgIGZvciAoY29uc3Qga2V5IGluIHJlY2lwZS5vdmVycmlkZV9hdHRyKSB7XG4gICAgICAgICAgICBuZXdFbGVtZW50LnNldEF0dHJpYnV0ZShrZXksIGV2YWwocmVjaXBlLm92ZXJyaWRlX2F0dHJba2V5XSkpO1xuICAgICAgICB9XG4gICAgfVxuICAgIC8vIFByb2Nlc3MgY2hpbGRyZW5cbiAgICBpZiAocmVjaXBlLmNoaWxkcmVuICYmIHJlY2lwZS5jaGlsZHJlbi5sZW5ndGggPiAwKSB7XG4gICAgICAgIGZvciAoY29uc3QgY2hpbGRSZWNpcGUgb2YgcmVjaXBlLmNoaWxkcmVuKSB7XG4gICAgICAgICAgICBjb25zdCBzZWxlY3RvciA9IGNoaWxkUmVjaXBlLmRpcmVjdF9jaGlsZCA/IGA6c2NvcGUgPiAke2NoaWxkUmVjaXBlLnNlbGVjdG9yfWAgOiBjaGlsZFJlY2lwZS5zZWxlY3RvcjtcbiAgICAgICAgICAgIGNvbnN0IGNoaWxkRWxlbWVudHMgPSBlbGVtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoc2VsZWN0b3IpO1xuICAgICAgICAgICAgY2hpbGRFbGVtZW50cy5mb3JFYWNoKChjaGlsZEVsZW1lbnQsIGluZGV4KSA9PiB7XG4gICAgICAgICAgICAgICAgY29uc3QgY2hpbGROb2RlID0gcHJvY2Vzc0VsZW1lbnQoY2hpbGRFbGVtZW50LCBjaGlsZFJlY2lwZSwgcGFyZW50TmFtZSwgaW5kZXgpO1xuICAgICAgICAgICAgICAgIG5ld0VsZW1lbnQuYXBwZW5kQ2hpbGQoY2hpbGROb2RlKTtcbiAgICAgICAgICAgICAgICBpZiAoY2hpbGRSZWNpcGUuaW5zZXJ0X3NwbGl0X21hcmtlcikge1xuICAgICAgICAgICAgICAgICAgICBjb25zdCBldmVyeSA9IGNoaWxkUmVjaXBlLmluc2VydF9zcGxpdF9tYXJrZXJfZXZlcnkgfHwgMTtcbiAgICAgICAgICAgICAgICAgICAgaWYgKGluZGV4ICUgZXZlcnkgPT0gMCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgY29uc3Qgc3BsaXRNYXJrZXIgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdzcGxpdC1tYXJrZXInKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIG5ld0VsZW1lbnQuYXBwZW5kQ2hpbGQoc3BsaXRNYXJrZXIpO1xuICAgICAgICAgICAgICAgICAgICAgICAgLy8gY29uc29sZS5sb2coXCJpbnNlcnRpbmcgc3BsaXQgbWFya2VyIDFcIik7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgaWYgKGNoaWxkUmVjaXBlLmluc2VydF9zcGxpdF9tYXJrZXIpIHtcbiAgICAgICAgICAgICAgICAgICAgLy8gY29uc29sZS5sb2coXCJpbnNlcnRpbmcgc3BsaXQgbWFya2VyIDJcIik7XG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IHNwbGl0TWFya2VyID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnc3BsaXQtbWFya2VyJyk7XG4gICAgICAgICAgICAgICAgICAgIG5ld0VsZW1lbnQuYXBwZW5kQ2hpbGQoc3BsaXRNYXJrZXIpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coXCJubyBzcGxpdCBtYXJrZXJcIik7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICB9XG4gICAgLy8gSGFuZGxlIGVtcHR5IG1lc3NhZ2VzXG4gICAgaWYgKHJlY2lwZS5lbXB0eV9tZXNzYWdlICYmIG5ld0VsZW1lbnQuY2hpbGRyZW4ubGVuZ3RoID09PSAwKSB7XG4gICAgICAgIGNvbnN0IGVtcHR5VGV4dE5vZGUgPSBkb2N1bWVudC5jcmVhdGVUZXh0Tm9kZShyZWNpcGUuZW1wdHlfbWVzc2FnZSk7XG4gICAgICAgIG5ld0VsZW1lbnQuYXBwZW5kQ2hpbGQoZW1wdHlUZXh0Tm9kZSk7XG4gICAgfVxuICAgIHJldHVybiBuZXdFbGVtZW50O1xufVxuZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcignRE9NQ29udGVudExvYWRlZCcsICgpID0+IF9fYXdhaXRlcih2b2lkIDAsIHZvaWQgMCwgdm9pZCAwLCBmdW5jdGlvbiogKCkge1xuICAgIGNvbnNvbGUubG9nKCdET01Db250ZW50TG9hZGVkJyk7XG4gICAgY29uc3QgdXJsID0gd2luZG93LmxvY2F0aW9uLmhyZWY7XG4gICAgdHJ5IHtcbiAgICAgICAgY29uc3QgcmVzcG9uc2UgPSB5aWVsZCBuZXcgUHJvbWlzZShyZXNvbHZlID0+IHtcbiAgICAgICAgICAgIGNocm9tZS5ydW50aW1lLnNlbmRNZXNzYWdlKHtcbiAgICAgICAgICAgICAgICBhY3Rpb246ICdnZXRSZWNpcGUnLFxuICAgICAgICAgICAgICAgIHVybDogdXJsXG4gICAgICAgICAgICB9LCByZXNvbHZlKTtcbiAgICAgICAgfSk7XG4gICAgICAgIGNvbnNvbGUubG9nKCdyZXNwb25zZScpO1xuICAgICAgICBpZiAocmVzcG9uc2UgJiYgcmVzcG9uc2UucmVjaXBlKSB7XG4gICAgICAgICAgICBjb25zdCByZWNpcGUgPSByZXNwb25zZS5yZWNpcGU7XG4gICAgICAgICAgICBjb25zdCByb290RWxlbWVudCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IocmVjaXBlLnNlbGVjdG9yKTtcbiAgICAgICAgICAgIGlmIChyb290RWxlbWVudCkge1xuICAgICAgICAgICAgICAgIGNvbnN0IG5ld1Jvb3QgPSBwcm9jZXNzRWxlbWVudChyb290RWxlbWVudCwgcmVjaXBlKTtcbiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhuZXdSb290Lm91dGVySFRNTCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9XG4gICAgY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgIGNvbnNvbGUuZXJyb3IoJ0Vycm9yIGluaXRpYWxpemluZyBjbGlja2FibGUgZWxlbWVudHM6JywgZXJyb3IpO1xuICAgIH1cbiAgICB0cnkge1xuICAgICAgICBjb25zdCB0aW1lc3RhbXAgPSBuZXcgRGF0ZSgpLnRvSVNPU3RyaW5nKCk7XG4gICAgICAgIGNhcHR1cmVTY3JlZW5zaG90KHRpbWVzdGFtcCk7XG4gICAgICAgIGNhcHR1cmVJbnRlcmFjdGlvbignbmF2aWdhdGUnLCAnJywgdGltZXN0YW1wLCAnJywgJycsIHVybCk7XG4gICAgfVxuICAgIGNhdGNoIChlcnJvcikge1xuICAgICAgICBjb25zb2xlLmVycm9yKCdFcnJvciBjYXB0dXJpbmcgc2NyZWVuc2hvdDonLCBlcnJvcik7XG4gICAgfVxufSkpO1xuZnVuY3Rpb24gZ2VuZXJhdGVIdG1sU25hcHNob3RJZCgpIHtcbiAgICBjb25zdCB1cmwgPSB3aW5kb3cubG9jYXRpb24uaHJlZjtcbiAgICBjb25zdCB0aW1lc3RhbXAgPSBuZXcgRGF0ZSgpLnRvSVNPU3RyaW5nKCk7XG4gICAgcmV0dXJuIGBodG1sXyR7aGFzaENvZGUodXJsKX1fJHt0aW1lc3RhbXB9YDtcbn1cbmZ1bmN0aW9uIGhhc2hDb2RlKHN0cikge1xuICAgIGxldCBoYXNoID0gMDtcbiAgICBmb3IgKGxldCBpID0gMDsgaSA8IHN0ci5sZW5ndGg7IGkrKykge1xuICAgICAgICBoYXNoID0gKChoYXNoIDw8IDUpIC0gaGFzaCkgKyBzdHIuY2hhckNvZGVBdChpKTtcbiAgICAgICAgaGFzaCB8PSAwO1xuICAgIH1cbiAgICBjb25zb2xlLmxvZyhcIkhhc2ggdmFsdWUgYmVmb3JlIHJldHVybjpcIiwgaGFzaCk7XG4gICAgcmV0dXJuIGhhc2gudG9TdHJpbmcoKTtcbn1cbi8vIEZ1bmN0aW9uIHRvIGdldCBjbGlja2FibGUgZWxlbWVudHMgaW4gdGhlIHZpZXdwb3J0XG5mdW5jdGlvbiBnZXRDbGlja2FibGVFbGVtZW50c0luVmlld3BvcnQoKSB7XG4gICAgY29uc3QgY2xpY2thYmxlRWxlbWVudHMgPSBbXTsgLy8gQXJyYXkgdG8gc3RvcmUgY2xpY2thYmxlIGVsZW1lbnRzXG4gICAgLy8gU2VsZWN0IGFsbCBwb3RlbnRpYWwgY2xpY2thYmxlIGVsZW1lbnRzXG4gICAgY29uc3QgYWxsRWxlbWVudHMgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKCdhLCBidXR0b24sIFtvbmNsaWNrXSwgaW5wdXRbdHlwZT1cImJ1dHRvblwiXSwgaW5wdXRbdHlwZT1cInN1Ym1pdFwiXScpO1xuICAgIC8vIENoZWNrIGlmIGVhY2ggZWxlbWVudCBpcyBpbiB0aGUgdmlld3BvcnRcbiAgICBhbGxFbGVtZW50cy5mb3JFYWNoKChlbGVtZW50KSA9PiB7XG4gICAgICAgIGNvbnN0IHJlY3QgPSBlbGVtZW50LmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpO1xuICAgICAgICBpZiAocmVjdC50b3AgPj0gMCAmJlxuICAgICAgICAgICAgcmVjdC5sZWZ0ID49IDAgJiZcbiAgICAgICAgICAgIHJlY3QuYm90dG9tIDw9ICh3aW5kb3cuaW5uZXJIZWlnaHQgfHwgZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50LmNsaWVudEhlaWdodCkgJiZcbiAgICAgICAgICAgIHJlY3QucmlnaHQgPD0gKHdpbmRvdy5pbm5lcldpZHRoIHx8IGRvY3VtZW50LmRvY3VtZW50RWxlbWVudC5jbGllbnRXaWR0aCkpIHtcbiAgICAgICAgICAgIGNsaWNrYWJsZUVsZW1lbnRzLnB1c2goe1xuICAgICAgICAgICAgICAgIHRhZ05hbWU6IGVsZW1lbnQudGFnTmFtZSxcbiAgICAgICAgICAgICAgICBjbGFzc05hbWU6IGVsZW1lbnQuY2xhc3NOYW1lLFxuICAgICAgICAgICAgICAgIGlkOiBlbGVtZW50LmlkLFxuICAgICAgICAgICAgICAgIGlubmVyVGV4dDogZWxlbWVudC5pbm5lclRleHQudHJpbSgpLFxuICAgICAgICAgICAgICAgIG91dGVySFRNTDogZWxlbWVudC5vdXRlckhUTUwudHJpbSgpLFxuICAgICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICB9KTtcbiAgICByZXR1cm4gY2xpY2thYmxlRWxlbWVudHM7XG59XG4vLyBGdW5jdGlvbiB0byBjYXB0dXJlIGludGVyYWN0aW9uc1xuZnVuY3Rpb24gY2FwdHVyZUludGVyYWN0aW9uKGV2ZW50VHlwZSwgdGFyZ2V0LCB0aW1lc3RhbXAsIHNlbGVjdG9yLCBjbGlja2FibGVJZCwgdXJsKSB7XG4gICAgcmV0dXJuIF9fYXdhaXRlcih0aGlzLCB2b2lkIDAsIHZvaWQgMCwgZnVuY3Rpb24qICgpIHtcbiAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgIC8vIEdlbmVyYXRlIG5ldyBIVE1MIHNuYXBzaG90IElEXG4gICAgICAgICAgICBjb25zdCBjdXJyZW50U25hcHNob3RJZCA9IGdlbmVyYXRlSHRtbFNuYXBzaG90SWQoKTtcbiAgICAgICAgICAgIC8vIFNhdmUgSFRNTCBzbmFwc2hvdCBhbmQgd2FpdCBmb3IgaXQgdG8gY29tcGxldGVcbiAgICAgICAgICAgIHlpZWxkIG5ldyBQcm9taXNlKChyZXNvbHZlLCByZWplY3QpID0+IHtcbiAgICAgICAgICAgICAgICBjaHJvbWUuc3RvcmFnZS5sb2NhbC5nZXQoWydodG1sU25hcHNob3RzJ10sIChyZXN1bHQpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgaHRtbFNuYXBzaG90cyA9IHJlc3VsdC5odG1sU25hcHNob3RzIHx8IHt9O1xuICAgICAgICAgICAgICAgICAgICBodG1sU25hcHNob3RzW2N1cnJlbnRTbmFwc2hvdElkXSA9IGRvY3VtZW50LmRvY3VtZW50RWxlbWVudC5vdXRlckhUTUw7XG4gICAgICAgICAgICAgICAgICAgIGNocm9tZS5zdG9yYWdlLmxvY2FsLnNldCh7IGh0bWxTbmFwc2hvdHMgfSwgKCkgPT4ge1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGNocm9tZS5ydW50aW1lLmxhc3RFcnJvcikge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlamVjdChjaHJvbWUucnVudGltZS5sYXN0RXJyb3IpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVzb2x2ZSh2b2lkIDApO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgLy8gY29uc3QgY2xpY2thYmxlRWxlbWVudHMgPSBnZXRDbGlja2FibGVFbGVtZW50c0luVmlld3BvcnQoKTtcbiAgICAgICAgICAgIGNvbnN0IGRhdGEgPSB7XG4gICAgICAgICAgICAgICAgZXZlbnRUeXBlLFxuICAgICAgICAgICAgICAgIHRpbWVzdGFtcDogdGltZXN0YW1wLFxuICAgICAgICAgICAgICAgIHRhcmdldDogdGFyZ2V0LFxuICAgICAgICAgICAgICAgIHRhcmdldE91dGVySFRNTDogdGFyZ2V0Lm91dGVySFRNTCxcbiAgICAgICAgICAgICAgICB0YXJnZXRDbGFzczogdGFyZ2V0LmNsYXNzTmFtZSxcbiAgICAgICAgICAgICAgICB0YXJnZXRJZDogdGFyZ2V0LmlkLFxuICAgICAgICAgICAgICAgIHRhcmdldFRleHQ6IHRhcmdldC5pbm5lclRleHQgfHwgdGFyZ2V0LnZhbHVlIHx8ICcnLFxuICAgICAgICAgICAgICAgIGh0bWxTbmFwc2hvdElkOiBjdXJyZW50U25hcHNob3RJZCxcbiAgICAgICAgICAgICAgICAvLyBjbGlja2FibGVFbGVtZW50czogY2xpY2thYmxlRWxlbWVudHMsXG4gICAgICAgICAgICAgICAgc2VsZWN0b3I6IHNlbGVjdG9yIHx8ICcnLFxuICAgICAgICAgICAgICAgIGNsaWNrYWJsZUlkOiBjbGlja2FibGVJZCB8fCAnJyxcbiAgICAgICAgICAgICAgICB1cmw6IHVybCB8fCAnJyxcbiAgICAgICAgICAgIH07XG4gICAgICAgICAgICB5aWVsZCBjaHJvbWUucnVudGltZS5zZW5kTWVzc2FnZSh7IGFjdGlvbjogJ3NhdmVEYXRhJywgZGF0YSB9KTtcbiAgICAgICAgfVxuICAgICAgICBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoYEVycm9yIGR1cmluZyAke2V2ZW50VHlwZX0gZXZlbnQgaGFuZGxpbmc6YCwgZXJyb3IpO1xuICAgICAgICB9XG4gICAgfSk7XG59XG4vLyBDYXB0dXJlIHNjcm9sbCBpbnRlcmFjdGlvbnNcbmRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoJ3Njcm9sbCcsIChldmVudCkgPT4gX19hd2FpdGVyKHZvaWQgMCwgdm9pZCAwLCB2b2lkIDAsIGZ1bmN0aW9uKiAoKSB7XG4gICAgdHJ5IHtcbiAgICAgICAgY29uc3QgY3VycmVudFRpbWUgPSBEYXRlLm5vdygpO1xuICAgICAgICBpZiAoY3VycmVudFRpbWUgLSBsYXN0U2Nyb2xsVGltZSA+PSBTQ1JPTExfVEhSRVNIT0xEKSB7XG4gICAgICAgICAgICBsYXN0U2Nyb2xsVGltZSA9IGN1cnJlbnRUaW1lO1xuICAgICAgICAgICAgY29uc3QgdGltZXN0YW1wID0gbmV3IERhdGUoKS50b0lTT1N0cmluZygpO1xuICAgICAgICAgICAgLy8gT25seSBjYXB0dXJlIHRoZSBzY3JlZW5zaG90IGFmdGVyIDMgc2Vjb25kcyBvZiBpbmFjdGl2aXR5XG4gICAgICAgICAgICB5aWVsZCBjYXB0dXJlSW50ZXJhY3Rpb24oJ3Njcm9sbCcsIGV2ZW50LnRhcmdldCwgdGltZXN0YW1wLCAnJywgJycsICcnKTtcbiAgICAgICAgICAgIHlpZWxkIGNhcHR1cmVTY3JlZW5zaG90KHRpbWVzdGFtcCk7XG4gICAgICAgIH1cbiAgICB9XG4gICAgY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgIGNvbnNvbGUuZXJyb3IoJ0Vycm9yIGR1cmluZyBzY3JvbGwgZXZlbnQgaGFuZGxpbmc6JywgZXJyb3IpO1xuICAgIH1cbn0pKTtcbmRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoXCJibHVyXCIsIChldmVudCkgPT4gX19hd2FpdGVyKHZvaWQgMCwgdm9pZCAwLCB2b2lkIDAsIGZ1bmN0aW9uKiAoKSB7XG4gICAgaWYgKGV2ZW50LnRhcmdldCAmJiBldmVudC50YXJnZXQudGFnTmFtZSA9PT0gXCJJTlBVVFwiIHx8IGV2ZW50LnRhcmdldC50YWdOYW1lID09PSBcIlRFWFRBUkVBXCIpIHtcbiAgICAgICAgY29uc3QgdGFyZ2V0ID0gZXZlbnQudGFyZ2V0O1xuICAgICAgICBjb25zdCB0aW1lc3RhbXAgPSBuZXcgRGF0ZSgpLnRvSVNPU3RyaW5nKCk7XG4gICAgICAgIHlpZWxkIGNhcHR1cmVTY3JlZW5zaG90KHRpbWVzdGFtcCk7XG4gICAgICAgIHlpZWxkIGNhcHR1cmVJbnRlcmFjdGlvbihcImlucHV0XCIsIHRhcmdldCwgdGltZXN0YW1wLCAnJywgJycsICcnKTtcbiAgICB9XG59KSwgdHJ1ZSk7XG4vLyBDYXB0dXJlIGNsaWNrIGludGVyYWN0aW9uc1xuZnVuY3Rpb24gZ2V0VW5pcXVlU2VsZWN0b3IoZWxlbWVudCkge1xuICAgIGlmIChlbGVtZW50LmlkKSB7XG4gICAgICAgIHJldHVybiBgIyR7ZWxlbWVudC5pZH1gO1xuICAgIH1cbiAgICBpZiAoZWxlbWVudC5jbGFzc05hbWUpIHtcbiAgICAgICAgY29uc3QgY2xhc3NOYW1lID0gZWxlbWVudC5jbGFzc05hbWUudHJpbSgpLnNwbGl0KC9cXHMrLykuam9pbignLicpO1xuICAgICAgICByZXR1cm4gYCR7ZWxlbWVudC50YWdOYW1lLnRvTG93ZXJDYXNlKCl9LiR7Y2xhc3NOYW1lfWA7XG4gICAgfVxuICAgIHJldHVybiBlbGVtZW50LnRhZ05hbWUudG9Mb3dlckNhc2UoKTtcbn1cbmZ1bmN0aW9uIGdldEZ1bGxTZWxlY3RvcihlbGVtZW50KSB7XG4gICAgbGV0IHBhdGggPSBbXTtcbiAgICB3aGlsZSAoZWxlbWVudC5wYXJlbnRFbGVtZW50KSB7XG4gICAgICAgIHBhdGgudW5zaGlmdChnZXRVbmlxdWVTZWxlY3RvcihlbGVtZW50KSk7XG4gICAgICAgIGVsZW1lbnQgPSBlbGVtZW50LnBhcmVudEVsZW1lbnQ7XG4gICAgfVxuICAgIHJldHVybiBwYXRoLmpvaW4oJyA+ICcpO1xufVxuLy8gZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCBhc3luYyAoZXZlbnQpID0+IHtcbi8vICAgICB0cnkge1xuLy8gICAgICAgICB0aW1lc3RhbXA9bmV3IERhdGUoKS50b0lTT1N0cmluZygpO1xuLy8gICAgICAgICBjb25zdCBzZWxlY3Rvcj1nZXRGdWxsU2VsZWN0b3IoZXZlbnQudGFyZ2V0KTtcbi8vICAgICAgICAgLy8gY29uc3Qgb3JpZ2luYWxFbGVtZW50PWV2ZW50LnRhcmdldFxuLy8gICAgICAgICAvLyBjb25zdCBmb3VuZEVsZW1lbnQgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKHNlbGVjdG9yKTtcbi8vICAgICAgICAgLy8gY29uc3QgaXNTYW1lRWxlbWVudCA9IGZvdW5kRWxlbWVudCA9PT0gb3JpZ2luYWxFbGVtZW50O1xuLy8gICAgICAgICAvLyBjb25zb2xlLmxvZyhpc1NhbWVFbGVtZW50KVxuLy8gICAgICAgICBhd2FpdCBjYXB0dXJlU2NyZWVuc2hvdCh0aW1lc3RhbXApO1xuLy8gICAgICAgICBhd2FpdCBjYXB0dXJlSW50ZXJhY3Rpb24oJ2NsaWNrJywgZXZlbnQudGFyZ2V0LHRpbWVzdGFtcCxzZWxlY3Rvcik7XG4vLyAgICAgfSBjYXRjaCAoZXJyb3IpIHtcbi8vICAgICAgICAgY29uc29sZS5lcnJvcignRXJyb3IgZHVyaW5nIGNsaWNrIGV2ZW50IGhhbmRsaW5nOicsIGVycm9yKTtcbi8vICAgICB9XG4vLyB9KTtcbmRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgKGV2ZW50KSA9PiB7XG4gICAgdHJ5IHtcbiAgICAgICAgZnVuY3Rpb24gZmluZENsaWNrYWJsZVBhcmVudChlbGVtZW50LCBkZXB0aCA9IDApIHtcbiAgICAgICAgICAgIGlmICghZWxlbWVudCB8fCBkZXB0aCA+PSAyKVxuICAgICAgICAgICAgICAgIHJldHVybiBudWxsO1xuICAgICAgICAgICAgaWYgKGVsZW1lbnQuaGFzQXR0cmlidXRlKCdkYXRhLWNsaWNrYWJsZS1pZCcpKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGVsZW1lbnQ7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm4gZmluZENsaWNrYWJsZVBhcmVudChlbGVtZW50LnBhcmVudEVsZW1lbnQsIGRlcHRoICsgMSk7XG4gICAgICAgIH1cbiAgICAgICAgY29uc3QgY2xpY2thYmxlRWxlbWVudCA9IGZpbmRDbGlja2FibGVQYXJlbnQoZXZlbnQudGFyZ2V0KTtcbiAgICAgICAgY29uc3QgY2xpY2thYmxlSWQgPSBjbGlja2FibGVFbGVtZW50ID8gY2xpY2thYmxlRWxlbWVudC5nZXRBdHRyaWJ1dGUoJ2RhdGEtY2xpY2thYmxlLWlkJykgfHwgJycgOiAnJztcbiAgICAgICAgY29uc29sZS5sb2coJ2NsaWNrJyk7XG4gICAgICAgIGNvbnN0IHRpbWVzdGFtcCA9IG5ldyBEYXRlKCkudG9JU09TdHJpbmcoKTtcbiAgICAgICAgY29uc29sZS5sb2codGltZXN0YW1wKTtcbiAgICAgICAgY29uc3Qgc2VsZWN0b3IgPSBnZXRGdWxsU2VsZWN0b3IoZXZlbnQudGFyZ2V0KTtcbiAgICAgICAgY29uc29sZS5sb2coJ3NyYXJ0IHNjcmVlbnNob3QnKTtcbiAgICAgICAgY2FwdHVyZVNjcmVlbnNob3QodGltZXN0YW1wKTtcbiAgICAgICAgY29uc29sZS5sb2coJ2VuZCBzY3JlZW5zaG90Jyk7XG4gICAgICAgIGNhcHR1cmVJbnRlcmFjdGlvbignY2xpY2snLCBldmVudC50YXJnZXQsIHRpbWVzdGFtcCwgc2VsZWN0b3IsIGNsaWNrYWJsZUlkLCAnJyk7XG4gICAgICAgIGNvbnNvbGUubG9nKCdlbmQnKTtcbiAgICB9XG4gICAgY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgIGNvbnNvbGUuZXJyb3IoJ0Vycm9yIGR1cmluZyBjbGljayBldmVudCBoYW5kbGluZzonLCBlcnJvcik7XG4gICAgfVxufSk7XG4vLyBGdW5jdGlvbiB0byBjYXB0dXJlIHNjcmVlbnNob3RzIHdpdGggdW5pcXVlIElEXG5mdW5jdGlvbiBjYXB0dXJlU2NyZWVuc2hvdCh0aW1lc3RhbXApIHtcbiAgICByZXR1cm4gX19hd2FpdGVyKHRoaXMsIHZvaWQgMCwgdm9pZCAwLCBmdW5jdGlvbiogKCkge1xuICAgICAgICB0cnkge1xuICAgICAgICAgICAgLy8gR2VuZXJhdGUgYSB1bmlxdWUgc2NyZWVuc2hvdCBJRFxuICAgICAgICAgICAgY29uc3Qgc2NyZWVuc2hvdElkID0gYHNjcmVlbnNob3RfJHt0aW1lc3RhbXB9YDtcbiAgICAgICAgICAgIC8vIENhcHR1cmUgdGhlIHNjcmVlbnNob3RcbiAgICAgICAgICAgIHlpZWxkIGNocm9tZS5ydW50aW1lLnNlbmRNZXNzYWdlKHsgYWN0aW9uOiAnY2FwdHVyZVNjcmVlbnNob3QnLCBzY3JlZW5zaG90SWQgfSk7XG4gICAgICAgIH1cbiAgICAgICAgY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgICAgICBjb25zb2xlLmVycm9yKCdFcnJvciBjYXB0dXJpbmcgc2NyZWVuc2hvdDonLCBlcnJvcik7XG4gICAgICAgIH1cbiAgICB9KTtcbn1cbmRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoXCJET01Db250ZW50TG9hZGVkXCIsICgpID0+IHtcbiAgICAvLyBnZXQgYWxsIFwiUGxhY2UgWW91ciBPcmRlclwiIGJ1dHRvbnNcbiAgICBjb25zdCBwbGFjZU9yZGVyQnV0dG9ucyA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoJ2lucHV0W2lkPVwicGxhY2VPcmRlclwiXScpO1xuICAgIGlmIChwbGFjZU9yZGVyQnV0dG9ucy5sZW5ndGggPT09IDApIHtcbiAgICAgICAgY29uc29sZS5sb2coXCJObyBQbGFjZSBZb3VyIE9yZGVyIGJ1dHRvbnMgZm91bmQhXCIpO1xuICAgICAgICByZXR1cm47XG4gICAgfVxuICAgIC8vIGdldCBhbGwgcHJvZHVjdCBpbmZvcm1hdGlvbiwgZmlsdGVyIG91dCBpbnRlcmZlcmVuY2UgaXRlbXNcbiAgICBjb25zdCBpdGVtcyA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoJy5saW5laXRlbS10aXRsZS10ZXh0Jyk7XG4gICAgY29uc3Qgb3JkZXJEZXRhaWxzID0gW107XG4gICAgaXRlbXMuZm9yRWFjaCgoaXRlbSkgPT4ge1xuICAgICAgICB2YXIgX2E7XG4gICAgICAgIC8vIGZpbHRlciBvdXQgaW50ZXJmZXJlbmNlIGl0ZW1zXG4gICAgICAgIGlmIChpdGVtLm1hdGNoZXMoJy5hLXNpemUtYmFzZS5saW5laXRlbS10aXRsZS10ZXh0JykpIHtcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKFwiU2tpcHBpbmcgaW50ZXJmZXJpbmcgZWxlbWVudDpcIiwgaXRlbS5pbm5lclRleHQpO1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICAgIC8vIGdldCBwcm9kdWN0IG5hbWVcbiAgICAgICAgY29uc3QgcHJvZHVjdE5hbWUgPSBpdGVtLmlubmVyVGV4dC50cmltKCk7XG4gICAgICAgIC8vIGdldCBwcm9kdWN0IHByaWNlXG4gICAgICAgIGNvbnN0IHByaWNlRWxlbWVudCA9IChfYSA9IGl0ZW0uY2xvc2VzdCgnZGl2JykpID09PSBudWxsIHx8IF9hID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYS5xdWVyeVNlbGVjdG9yKCcubGluZWl0ZW0tcHJpY2UtdGV4dCcpO1xuICAgICAgICBjb25zdCBwcm9kdWN0UHJpY2UgPSBwcmljZUVsZW1lbnQgJiYgcHJpY2VFbGVtZW50LmlubmVyVGV4dFxuICAgICAgICAgICAgPyBwcmljZUVsZW1lbnQuaW5uZXJUZXh0LnRyaW0oKS5yZXBsYWNlKCckJywgJycpXG4gICAgICAgICAgICA6ICcwLjAwJztcbiAgICAgICAgb3JkZXJEZXRhaWxzLnB1c2goe1xuICAgICAgICAgICAgbmFtZTogcHJvZHVjdE5hbWUsXG4gICAgICAgICAgICBwcmljZTogcGFyc2VGbG9hdChwcm9kdWN0UHJpY2UpLFxuICAgICAgICB9KTtcbiAgICB9KTtcbiAgICAvLyBhZGQgbGlzdGVuZXIgdG8gZWFjaCBidXR0b25cbiAgICBwbGFjZU9yZGVyQnV0dG9ucy5mb3JFYWNoKChidXR0b24pID0+IHtcbiAgICAgICAgYnV0dG9uLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCAoZXZlbnQpID0+IF9fYXdhaXRlcih2b2lkIDAsIHZvaWQgMCwgdm9pZCAwLCBmdW5jdGlvbiogKCkge1xuICAgICAgICAgICAgY29uc29sZS5sb2coXCJQbGFjZSBZb3VyIE9yZGVyIGJ1dHRvbiBjbGlja2VkIVwiKTtcbiAgICAgICAgICAgIGxldCByZXN1bHQgPSB5aWVsZCBjaHJvbWUuc3RvcmFnZS5sb2NhbC5nZXQoeyBvcmRlckRldGFpbHM6IFtdIH0pO1xuICAgICAgICAgICAgcmVzdWx0ID0gcmVzdWx0Lm9yZGVyRGV0YWlscyB8fCBbXTtcbiAgICAgICAgICAgIGxldCBzdG9yZU9yZGVyRGV0YWlscyA9IHJlc3VsdC5jb25jYXQob3JkZXJEZXRhaWxzKTtcbiAgICAgICAgICAgIHlpZWxkIGNocm9tZS5zdG9yYWdlLmxvY2FsLnNldCh7IG9yZGVyRGV0YWlsczogc3RvcmVPcmRlckRldGFpbHMgfSk7XG4gICAgICAgIH0pKTtcbiAgICB9KTtcbn0pO1xuZXhwb3J0IHt9O1xuIl0sIm5hbWVzIjpbIl9fYXdhaXRlciIsInRoaXNBcmciLCJfYXJndW1lbnRzIiwiUCIsImdlbmVyYXRvciIsIlByb21pc2UiLCJyZXNvbHZlIiwicmVqZWN0IiwiZnVsZmlsbGVkIiwidmFsdWUiLCJzdGVwIiwibmV4dCIsImUiLCJyZWplY3RlZCIsInJlc3VsdCIsImRvbmUiLCJ0aGVuIiwiYXBwbHkiLCJsYXN0U2Nyb2xsVGltZSIsIlNDUk9MTF9USFJFU0hPTEQiLCJodG1sU25hcHNob3RJZCIsInByb2Nlc3NFbGVtZW50IiwiZWxlbWVudCIsInJlY2lwZSIsInBhcmVudE5hbWUiLCJudGhDaGlsZCIsInRhZ05hbWUiLCJ0YWdfbmFtZSIsInRvTG93ZXJDYXNlIiwiZW5kc1dpdGgiLCJzbGljZSIsIm5ld0VsZW1lbnQiLCJkb2N1bWVudCIsImNyZWF0ZUVsZW1lbnQiLCJlbGVtZW50VGV4dCIsInRleHRfc2VsZWN0b3IiLCJ0ZXh0RWxlbWVudCIsInF1ZXJ5U2VsZWN0b3IiLCJpbm5lclRleHQiLCJ0ZXh0Q29udGVudCIsInRleHRfanMiLCJldmFsIiwiYWRkX3RleHQiLCJyZXBsYWNlIiwidHJpbSIsInRleHRfZm9ybWF0IiwiZWxlbWVudE5hbWUiLCJuYW1lIiwidG9TdHJpbmciLCJzZXRBdHRyaWJ1dGUiLCJjbGlja2FibGUiLCJFcnJvciIsImNsaWNrX2VsZW1lbnQiLCJjbGlja19zZWxlY3RvciIsImNvbnNvbGUiLCJsb2ciLCJ3aW5kb3ciLCJjbGlja2FibGVfcmVjaXBlcyIsImlucHV0VHlwZSIsImdldEF0dHJpYnV0ZSIsImluY2x1ZGVzIiwiY2hlY2tlZCIsImlucHV0X3JlY2lwZXMiLCJvcHRpb25zIiwicXVlcnlTZWxlY3RvckFsbCIsImZvckVhY2giLCJvcHRpb24iLCJvcHRpb25WYWx1ZSIsIm9wdGlvbk5hbWUiLCJuZXdPcHRpb24iLCJzZWxlY3RlZCIsImFwcGVuZENoaWxkIiwiYXR0cnNUb0NvcHkiLCJhdHRyIiwia2VlcF9hdHRyIiwia2V5Iiwib3ZlcnJpZGVfYXR0ciIsImNoaWxkcmVuIiwibGVuZ3RoIiwiY2hpbGRSZWNpcGUiLCJzZWxlY3RvciIsImRpcmVjdF9jaGlsZCIsImNoaWxkRWxlbWVudHMiLCJjaGlsZEVsZW1lbnQiLCJpbmRleCIsImNoaWxkTm9kZSIsImluc2VydF9zcGxpdF9tYXJrZXIiLCJpbnNlcnRfc3BsaXRfbWFya2VyX2V2ZXJ5Iiwic3BsaXRNYXJrZXIiLCJlbXB0eV9tZXNzYWdlIiwiZW1wdHlUZXh0Tm9kZSIsImNyZWF0ZVRleHROb2RlIiwiZ2VuZXJhdGVIdG1sU25hcHNob3RJZCIsInVybCIsImxvY2F0aW9uIiwiaHJlZiIsInRpbWVzdGFtcCIsIkRhdGUiLCJ0b0lTT1N0cmluZyIsImhhc2hDb2RlIiwic3RyIiwiaGFzaCIsImkiLCJjaGFyQ29kZUF0IiwiZ2V0Q2xpY2thYmxlRWxlbWVudHNJblZpZXdwb3J0IiwiY2xpY2thYmxlRWxlbWVudHMiLCJyZWN0IiwiZ2V0Qm91bmRpbmdDbGllbnRSZWN0IiwidG9wIiwibGVmdCIsImJvdHRvbSIsImlubmVySGVpZ2h0IiwiZG9jdW1lbnRFbGVtZW50IiwiY2xpZW50SGVpZ2h0IiwicmlnaHQiLCJpbm5lcldpZHRoIiwiY2xpZW50V2lkdGgiLCJwdXNoIiwiY2xhc3NOYW1lIiwiaWQiLCJvdXRlckhUTUwiLCJjYXB0dXJlSW50ZXJhY3Rpb24iLCJldmVudFR5cGUiLCJ0YXJnZXQiLCJjbGlja2FibGVJZCIsInRoaXMiLCJjdXJyZW50U25hcHNob3RJZCIsImNocm9tZSIsInN0b3JhZ2UiLCJsb2NhbCIsImdldCIsImh0bWxTbmFwc2hvdHMiLCJzZXQiLCJydW50aW1lIiwibGFzdEVycm9yIiwiZGF0YSIsInRhcmdldE91dGVySFRNTCIsInRhcmdldENsYXNzIiwidGFyZ2V0SWQiLCJ0YXJnZXRUZXh0Iiwic2VuZE1lc3NhZ2UiLCJhY3Rpb24iLCJlcnJvciIsImdldFVuaXF1ZVNlbGVjdG9yIiwic3BsaXQiLCJqb2luIiwiZ2V0RnVsbFNlbGVjdG9yIiwicGF0aCIsInBhcmVudEVsZW1lbnQiLCJ1bnNoaWZ0IiwiY2FwdHVyZVNjcmVlbnNob3QiLCJzY3JlZW5zaG90SWQiLCJhZGRFdmVudExpc3RlbmVyIiwicmVzcG9uc2UiLCJyb290RWxlbWVudCIsIm5ld1Jvb3QiLCJldmVudCIsImN1cnJlbnRUaW1lIiwibm93IiwiZmluZENsaWNrYWJsZVBhcmVudCIsImRlcHRoIiwiaGFzQXR0cmlidXRlIiwiY2xpY2thYmxlRWxlbWVudCIsInBsYWNlT3JkZXJCdXR0b25zIiwiaXRlbXMiLCJvcmRlckRldGFpbHMiLCJpdGVtIiwiX2EiLCJtYXRjaGVzIiwicHJvZHVjdE5hbWUiLCJwcmljZUVsZW1lbnQiLCJjbG9zZXN0IiwicHJvZHVjdFByaWNlIiwicHJpY2UiLCJwYXJzZUZsb2F0IiwiYnV0dG9uIiwic3RvcmVPcmRlckRldGFpbHMiLCJjb25jYXQiXSwic291cmNlUm9vdCI6IiJ9